
<!DOCTYPE html>
<html lang="zh-CN">
<head>
 <meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
<meta HTTP-EQUIV="pragma" CONTENT="no-cache">
<meta HTTP-EQUIV="Cache-Control" CONTENT="no-cache, must-revalidate">
<meta HTTP-EQUIV="expires" CONTENT="0">
<meta name="author" content="bwrong, wang11535041@qq.com"/>
<meta name="keywords" content="ã€å‰ç«¯å·¥ç¨‹åŒ–ã€‘ç¯‡å›› å¸­å·å…«è’-Webpackï¼ˆè¿›é˜¶ï¼‰ | BWrongçš„å°ç«™,å‰ç«¯,krpano,js,vue"/>
<meta name="description" content="å¤©é’è‰²ç­‰çƒŸé›¨ï¼Œè€Œæˆ‘åœ¨ç­‰ä½ "/>
<!-- <title>ã€å‰ç«¯å·¥ç¨‹åŒ–ã€‘ç¯‡å›› å¸­å·å…«è’-Webpackï¼ˆè¿›é˜¶ï¼‰ | BWrongçš„å°ç«™</title> -->
<title>ç½‘ç«™æ­å»ºæµ‹è¯•</title>
<link href="https://www.bwrong.cn/media/css/fz.css" rel="stylesheet">
<link rel="stylesheet" href="https://www.bwrong.cn/styles/main.css">
<script type="text/javascript">
function getCSS()
{
        datetoday = new Date();
        timenow=datetoday.getTime();
        datetoday.setTime(timenow);
        thehour = datetoday.getHours();

        if (thehour<5)

            display = "https://www.bwrong.cn/media/css/night.css";

       else if (thehour>20)

            display = "https://www.bwrong.cn/media/css/night.css";

        else if (thehour>5)
     
            display = "https://www.bwrong.cn/media/css/day.css";

        else if (thehour<20)

            display = "https://www.bwrong.cn/media/css/day.css";


var css = '<';
        css+='link rel="stylesheet" href='+display+' \/';
        css+='>';
        document.write(css);
}
</script>
<link href="https://at.alicdn.com/t/font_1306644_ko4c4at97is.css" rel="stylesheet" />
<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
<link rel="stylesheet" href="https://www.bwrong.cn/media/css/katex.min.css">
<script type='text/javascript' src='https://www.bwrong.cn/media/scripts/script.js'></script>
<link href="https://cdn.bootcss.com/animate.css/3.5.2/animate.min.css" rel="stylesheet" />
  <script src="https://cdn.bootcss.com/wow/1.1.2/wow.min.js"></script>
  <script src="https://cdn.bootcss.com/highlight.js/9.15.8/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  <script>wow=new WOW({boxClass:'wow',animateClass:'animated',offset:0,mobile:true,live:true});wow.init();</script>

<script type="text/javascript">
window.onload=getCSS();
</script>
<!-- ç™¾åº¦ç»Ÿè®¡ -->
<script>
var _hmt = _hmt || [];
(function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?2c0e9e3f54ae20480b34c178578c4df8";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
})();
</script>


</head>
<body class="post-template-default single single-post postid-70 single-format-standard">
    <div id="wrapper">

	
<header id="header" class="site-header"
		
		style="background-image: linear-gradient(rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.2)),url(https://gitee.com/letwrong/Picture/raw/master/20201028124953.jpeg)"
		
		>
			<div class="site-branding">
									<h1 class="site-title"><a href="https://www.bwrong.cn" rel="home">BWrongçš„å°ç«™</a></h1>

					<h2 class="site-description">å¤©é’è‰²ç­‰çƒŸé›¨ï¼Œè€Œæˆ‘åœ¨ç­‰ä½ </h2>

							</div>
			<nav id="nav-wrapper">
				<div class="container">
					<div class="nav-toggle">
						<div class="bars">
							<div class="bar"></div>
							<div class="bar"></div>
							<div class="bar"></div>
						</div>
					</div>
					<div class="clear"></div>
					<ul id="" class="dove">
		 

<li>

	
		<a href="/">
		  é¦–é¡µ
		</a>
	  

    

<li>

	
		<a href="/archives/index.html">
		  å½’æ¡£
		</a>
	  

    

<li>

	
		<a href="/post/about/">
		  å…³äº
		</a>
	  

    

</ul>
</li>

</ul>				</div>
			</nav>
						<div class="jingge">


    

    

<a  href="https://github.com/BWrong" target="_blank" ><i class="iconfont icon-github"></i></a>
 
    

    

    

    

<a  href="https://juejin.cn/user/3421335914820280" target="_blank" ><i class="iconfont icon-telegram"></i></a>
 
    

    

    

    

    

    
        </header>


		<div id="content" class="container">
			<div class="row">
	<div class="col-md-8 site-main">

<article id="post-70" class="post-70 post type-post status-publish format-standard hentry category-5 tag-10 tag-9 tag-11">



		<div class="entry-content">
			<h1 data-wow-delay="0.4s"  class="wow fadeInUp entry-title">ã€å‰ç«¯å·¥ç¨‹åŒ–ã€‘ç¯‡å›› å¸­å·å…«è’-Webpackï¼ˆè¿›é˜¶ï¼‰</h1>
<div class="entry-meta">
<div class="wow fadeInUp"  data-wow-delay="0.6s">
	<i class="iconfont icon-rili"> <time class="lately-a" datetime="2020-10-28 12:50:23" itemprop="datePublished" pubdate="">2020-10-28</time></i>
	          </div>

</span>

		</div>

			<div class="wow fadeInUp entry-summary song"  data-wow-delay="0.1s">
				<p>å­—æ•°ï¼š12197ï¼Œ é˜…è¯»æ—¶é—´ï¼š35åˆ†é’Ÿï¼Œç‚¹å‡»<a href="https://www.bwrong.cn/post/dev-tools04/">é˜…è¯»åŸæ–‡</a></p>
<figure data-type="image" tabindex="1"><img src="https://gitee.com/letwrong/Picture/raw/master/20201028124953.jpeg" alt="" loading="lazy"></figure>
<blockquote>
<p>çŸ³å¯ç ´ä¹Ÿï¼Œè€Œä¸å¯å¤ºåšï¼›ä¸¹å¯ç£¨ä¹Ÿï¼Œè€Œä¸å¯å¤ºèµ¤         â€”â€”ã€Šå•æ°æ˜¥ç§‹Â·è¯šå»‰ã€‹</p>
</blockquote>
<p>ã€å‰ç«¯å·¥ç¨‹åŒ–ã€‘ç³»åˆ—æ–‡ç« é“¾æ¥ï¼š</p>
<ul>
<li><a href="https://www.bwrong.cn/post/dev-tools01/">01 æ‰¬å¸†èµ·èˆª-å¼€å‘ç¯å¢ƒ</a></li>
<li><a href="https://www.bwrong.cn/post/dev-tools02/">02 ç™½ç’§å¾®ç‘•-åŒ…ç®¡ç†å™¨</a></li>
<li><a href="https://www.bwrong.cn/post/dev-tools03/">03 å¸­å·å…«è’-WebpackåŸºç¡€ç¯‡</a></li>
</ul>
<p><em>ç¤ºä¾‹ä»£ç ä»“åº“ï¼š<a href="https://github.com/BWrong/dev-tools">https://github.com/BWrong/dev-tools</a></em></p>
<p><em>å£°æ˜ï¼šæœ¬ç¯‡æ–‡ç« åŸºäºwebpack v4.43.0ï¼Œå¦‚æŒ‰ç…§æ–‡ä¸­ä»£ç æ‰§è¡ŒæŠ¥é”™ï¼Œè¯·æ£€æŸ¥ä¾èµ–æ¨¡å—ç‰ˆæœ¬æ˜¯å¦å’Œç¤ºä¾‹ä»£ç ä»“åº“ä¸­ä¸€è‡´ã€‚</em></p>
<p>*æ¸©é¦¨æç¤ºï¼š*æœ¬ç¯‡å†…å®¹æ›´åå®æˆ˜ï¼Œæ¶‰åŠå¤§é‡ä»£ç ï¼Œå¦‚æœ‰ä»£ç å¯†é›†ææƒ§ç—‡çš„è€çˆ·ï¼Œè¯·é€Ÿé€Ÿç¦»åœºã€‚</p>
<p>åœ¨ä¸Šä¸€ç¯‡çš„å†…å®¹ä¸­ï¼Œä»‹ç»äº†webpackçš„æ ¸å¿ƒæ¦‚å¿µä»¥åŠå¸¸ç”¨çš„æ ¸å¿ƒé…ç½®ï¼Œå¹¶å°è¯•ç€é…ç½®äº†ä¸€ä¸ªé¡¹ç›®è„šæ‰‹æ¶ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥ï¼Œå°±è¿›å…¥é£å‡ç¯èŠ‚â€”â€”æ€§èƒ½ä¼˜åŒ–å’Œå®ç°åŸç†ã€‚</p>
<h1 id="é”¦ä¸Šæ·»èŠ±-ä¼˜åŒ–">é”¦ä¸Šæ·»èŠ±-ä¼˜åŒ–</h1>
<h2 id="ä½¿ç”¨åˆ†æå·¥å…·">ä½¿ç”¨åˆ†æå·¥å…·</h2>
<p>ä¼˜åŒ–å¦‚æœæ²¡æœ‰æ•°æ®é‡åŒ–åšæ”¯æ’‘ï¼Œè€Œä»…ä»…å‡­æ„Ÿè§‰ï¼Œéƒ½æ˜¯æ‰¯æ·¡çš„ï¼Œæ‰€ä»¥åœ¨åšä¼˜åŒ–å‰ï¼Œæœ‰å¿…è¦å…ˆæ¥äº†è§£ä¸€äº›æ„å»ºç»“æœåˆ†æå·¥å…·ï¼Œç”¨æ¥è·å–ç›¸å…³çš„é‡åŒ–æŒ‡æ ‡ï¼Œä¸ºä¼˜åŒ–å·¥ä½œæä¾›äº†æ–¹å‘å’Œä¾æ®ã€‚</p>
<h4 id="statsåˆ†æå·¥å…·">statsåˆ†æå·¥å…·</h4>
<p><a href="http://webpack.github.io/analyse/">statsåˆ†æå·¥å…·</a>æ˜¯webpackå®˜æ–¹æä¾›çš„åœ¨çº¿å·¥å…·ï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<ol>
<li>ç”Ÿæˆ<code>stat.json</code>æ–‡ä»¶ã€‚</li>
</ol>
<pre><code class="language-shell">webpack --profile --json &gt; stats.json
</code></pre>
<ol start="2">
<li>å°†<code>stat.json</code>æ–‡ä»¶ä¸Šä¼ åˆ°<a href="http://webpack.github.io/analyse/">statsåˆ†æå·¥å…·</a>é¡µé¢ä¸­ï¼Œå³å¯å¾—åˆ°åˆ†æç»“æœã€‚</li>
</ol>
<figure data-type="image" tabindex="2"><img src="https://gitee.com/letwrong/Picture/raw/master/20200601152126.png" alt="" loading="lazy"></figure>
<h4 id="ä½¿ç”¨webpack-bundle-analyzer">ä½¿ç”¨<code>webpack-bundle-analyzer</code></h4>
<p>é™¤äº†å®˜ç½‘æä¾›çš„åˆ†æå·¥å…·ï¼Œç¤¾åŒºè¿˜æä¾›äº†ä¸€ä¸ªæ›´åŠ å¥½ç”¨çš„åˆ†æç¥å™¨<a href="https://github.com/webpack-contrib/webpack-bundle-analyzer">webpack-bundle-analyzer</a> ï¼Œä¸ä»…ç•Œé¢ç¾è§‚ï¼Œè€Œä¸”å„ä¸ªä¾èµ–åŒ…åŠå…¶ä½“ç§¯å¤§å°ä¹Ÿæ›´åŠ ç›´è§‚ã€‚</p>
<pre><code class="language-shell">npm install webpack-bundle-analyzer -D
</code></pre>
<pre><code class="language-js">// build/webpack.prod.conf.js
const merge = require('webpack-merge');
const BundleAnalyzerPlugin = require('webpack-bundle-analyzer').BundleAnalyzerPlugin;
const baseConfig = require('./webpack.base.conf.js');

 module.exports = merge(baseConfig, {
   	mode: 'production',
    plugins: [
        new BundleAnalyzerPlugin(),
   		// ...
    ],
   // ...
 });
</code></pre>
<figure data-type="image" tabindex="3"><img src="https://gitee.com/letwrong/Picture/raw/master/20200601152927.png" alt="" loading="lazy"></figure>
<p>å›¾é‡Œé¢æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹Gzipå’ŒåŸå§‹çš„æ‰“åŒ…ç»“æœï¼Œä¹Ÿå¯ä»¥çœ‹åˆ°æ¯ä¸ªchunkåŒ…å«å“ªäº›åŒ…ï¼Œä»¥åŠå®ƒä»¬çš„ä½“ç§¯å¤§å°ç­‰ä¿¡æ¯ã€‚</p>
<h4 id="é€Ÿåº¦åˆ†æ">é€Ÿåº¦åˆ†æ</h4>
<p>ä¸Šé¢çš„ä¸¤ä¸ªå·¥å…·å‡æ˜¯ä¾§é‡äºæ‰“åŒ…ç»“æœçš„åˆ†æï¼Œé‡åœ¨ä¼˜åŒ–æ‰“åŒ…å“è´¨ã€‚è€Œé€šè¿‡ <a href="https://github.com/stephencookdev/speed-measure-webpack-plugin">speed-measure-webpack-plugin</a> è¿™ä¸ªæ’ä»¶è¿˜å¯ä»¥å®ç°å¯¹æ„å»ºè¿‡ç¨‹åˆ†æï¼Œä»è€Œä¼˜åŒ–æ„å»ºæ•ˆç‡ï¼Œæå‡æ‰“åŒ…çš„ä½“éªŒã€‚</p>
<pre><code class="language-shell">npm i -D speed-measure-webpack-plugin
</code></pre>
<pre><code class="language-js">// build/webpack.prod.conf.js
const SpeedMeasurePlugin = require(&quot;speed-measure-webpack-plugin&quot;);
const smp = new SpeedMeasurePlugin();
const webpackConfig = {
    // ...
}
module.exports = smp.wrap(webpackConfig) // éœ€è¦åŒ…è£¹åŸæ¥çš„é…ç½®
</code></pre>
<p>ç°åœ¨å°±å¯ä»¥çœ‹åˆ°æ¯ä¸ªloaderå’Œpluginè€—è´¹çš„æ—¶é—´ï¼Œä»¥ä¾¿å¯¹å…¶è¿›è¡Œä¼˜åŒ–ã€‚</p>
<figure data-type="image" tabindex="4"><img src="https://gitee.com/letwrong/Picture/raw/master/20201009111235.png" alt="image-20201009111235625" loading="lazy"></figure>
<h2 id="ä¼˜åŒ–åŒ…å“è´¨">ä¼˜åŒ–åŒ…å“è´¨</h2>
<p>webpack4.0åœ¨modeè®¾ç½®ä¸ºproductionæ—¶ï¼Œå…¶å®å·²ç»é»˜è®¤åšäº†å¾ˆå¤šä¼˜åŒ–æ‰‹æ®µæ¥æå‡è¾“å‡ºæˆæœå“è´¨ï¼Œä¸è¿‡äº†è§£ä¸€ä¸‹è¿˜æ˜¯æœ‰åŠ©äºæˆ‘ä»¬åšä¸€äº›æ›´åŠ æ·±å±‚æ¬¡çš„ä¼˜åŒ–ã€‚æ¯•ç«Ÿè¿™äº›å†…å®¹æ˜¯ç›´æ¥å…³ç³»åˆ°ç”¨æˆ·ä½“éªŒçš„ï¼Œéå¸¸é‡è¦ã€‚</p>
<h3 id="tree-shaking">Tree shaking</h3>
<p>Tree shaking è¿™ä¸ªæœ¯è¯­èµ·æºäº <a href="https://github.com/rollup/rollup">rollup</a>ï¼Œåœ¨webpack2.0æ­£å¼ç‰ˆå¼€å§‹å†…ç½®ï¼Œå¯ä»¥æ£€æµ‹åˆ°æœªä½¿ç”¨çš„æ¨¡å—ï¼Œä»¥ä¾¿å°†å…¶å‰”é™¤ã€‚å®ƒä¾èµ–äº ESModule æ¨¡å—ç³»ç»Ÿï¼ˆå…¶ä»–æ¨¡å—ç³»ç»Ÿä¸æ”¯æŒï¼‰ä¸­çš„<a href="http://exploringjs.com/es6/ch_modules.html#static-module-structure">é™æ€ç»“æ„ç‰¹æ€§</a>ï¼Œå¯ä»¥ç§»é™¤ JavaScript ä¸Šä¸‹æ–‡ä¸­çš„æœªå¼•ç”¨ä»£ç ï¼Œåˆ æ‰æœªä½¿ç”¨çš„ä»£ç ï¼Œèƒ½å¤Ÿæœ‰æ•ˆå‡å°‘ JS ä»£ç æ–‡ä»¶çš„å¤§å°ã€‚</p>
<blockquote>
<p>Tree shakingè¿™ä¸ªåå­—éå¸¸å½¢è±¡ï¼Œæ‘‡æ ‘-æ‘‡æ‰æ ‘ä¸Šå¤šä½™çš„ä¸œè¥¿ã€‚</p>
</blockquote>
<pre><code class="language-js">// src/math.js
export function square(x) {
  return x * x;
}

export function cube(x) {
  return x * x * x;
}

// src/index.js
import { cube } from './math.js' // ä»…å¼•ç”¨äº† cube è¿™ä¸ªæ–¹æ³•

console.log(cube(3))
</code></pre>
<p>ä¸Šé¢çš„ä»£ç å…¶å®åªæ˜¯ä½¿ç”¨äº†cubeï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼šå¸Œæœ›æœªä½¿ç”¨çš„ä»£ç ï¼ˆdead codeï¼‰æœ€å¥½èƒ½å¤Ÿä¸åŒ…å«åˆ°æˆæœä¸­ã€‚åœ¨æ–°ç‰ˆçš„webpackä¸­ï¼Œåœ¨productionçš„modeä¸‹ï¼Œå®ƒä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬ç§»é™¤æ²¡æœ‰ç”¨åˆ°çš„ä»£ç ï¼Œå‡å°‘è¾“å‡ºæˆæœçš„ä½“ç§¯ã€‚</p>
<p>åœ¨developmentçš„modeä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</p>
<pre><code class="language-js">// build/webpack.dev.conf.js
module.exports = {
  mode: 'development',
  optimization: {
    usedExports: true, // ä¸å¯¼å‡ºæ¨¡å—ä¸­æœªä½¿ç”¨çš„ä»£ç 
  },
}
</code></pre>
<p>åœ¨è¿›è¡Œæ­¤é…ç½®åï¼Œwebpackä¼šæ ‡è¯†æœªä½¿ç”¨çš„ä»£ç ï¼Œç„¶ååœ¨<a href="https://github.com/webpack-contrib/terser-webpack-plugin">TerserPlugin</a>æ‰§è¡Œå‹ç¼©çš„æ—¶å€™ç§»é™¤é‚£éƒ¨åˆ†ä»£ç ï¼ˆæ²¡æœ‰é¢å¤–çš„å‰¯ä½œç”¨ï¼‰ã€‚</p>
<p>å¦‚æœå¼€å‘è€…éœ€è¦è‡ªå·±æ¥æŒ‡å®šå“ªäº›æ¨¡å—æ²¡æœ‰å‰¯ä½œç”¨ï¼Œå¯ä»¥ä½¿ç”¨å¦å¤–ä¸€ç§æ–¹å¼ï¼ˆside effectï¼‰ï¼Œå®ƒå¯ä»¥é…ç½®åœ¨<code>package.json</code>çš„&quot;sideEffects&quot; å±æ€§ï¼ˆä¸»è¦é’ˆå¯¹ä¸€äº›åº“ï¼‰ï¼Œä¹Ÿå¯ä»¥åœ¨ <a href="https://webpack.docschina.org/configuration/module/#module-rules"><code>module.rules</code> é…ç½®é€‰é¡¹</a> ä¸­è®¾ç½® <code>&quot;sideEffects&quot;</code>ã€‚å¤§æ¦‚æœ‰å¦‚ä¸‹å‡ ç§æƒ…å½¢ï¼š</p>
<ul>
<li>å¦‚æœæ‰€æœ‰ä»£ç éƒ½ä¸åŒ…å«æœ‰side effectçš„ä»£ç ï¼Œç›´æ¥å°†è¯¥å±æ€§æ ‡è®°ä¸ºfalseï¼Œæ¥å‘ŠçŸ¥ webpackï¼Œå®ƒå¯ä»¥å®‰å…¨åœ°åˆ é™¤æœªç”¨åˆ°çš„ exportã€‚</li>
</ul>
<pre><code class="language-json">//package.json
{
  &quot;name&quot;: &quot;your-project&quot;,
  &quot;sideEffects&quot;: false
}
</code></pre>
<ul>
<li>å¦‚æœä»£ç ä¸­æœ‰éƒ¨åˆ†æ–‡ä»¶æœ‰å‰¯ä½œç”¨ï¼Œéœ€æ ‡è®°</li>
</ul>
<pre><code class="language-json">//package.json
{
  &quot;name&quot;: &quot;your-project&quot;,
  &quot;sideEffects&quot;: [
    &quot;./src/some-side-effectful-file.js&quot;,
    &quot;*.css&quot; // ä¸€èˆ¬csséƒ½æ˜¯å…·æœ‰å‰¯ä½œç”¨çš„ï¼Œéœ€è¦åœ¨æ­¤å£°æ˜
  ]
}
</code></pre>
<blockquote>
<p><em>&quot;side effect(å‰¯ä½œç”¨)&quot; çš„å®šä¹‰æ˜¯ï¼Œåœ¨å¯¼å…¥æ—¶ä¼šæ‰§è¡Œç‰¹æ®Šè¡Œä¸ºçš„ä»£ç ï¼Œè€Œä¸æ˜¯ä»…ä»…æš´éœ²ä¸€ä¸ª export æˆ–å¤šä¸ª exportã€‚ä¸¾ä¾‹è¯´æ˜ï¼Œä¾‹å¦‚ polyfillï¼Œå®ƒå½±å“å…¨å±€ä½œç”¨åŸŸï¼Œå¹¶ä¸”é€šå¸¸ä¸æä¾› exportã€‚</em></p>
<p>é’ˆå¯¹cssä¹Ÿæä¾›äº†ç›¸åº”çš„å·¥å…· <a href="https://purgecss.com/plugins/webpack.html#usage">PurgeCSS</a>æ¥å»é™¤æœªä½¿ç”¨çš„ä»£ç ï¼Œå’Œtree shakingæœ‰å¼‚æ›²åŒå·¥ä¹‹å¦™ã€‚</p>
</blockquote>
<h3 id="ä»£ç åˆ†å‰²">ä»£ç åˆ†å‰²</h3>
<p>åœ¨å•é¡µåº”ç”¨ï¼ˆsingle-page application ç®€ç§°ä¸º SPAï¼‰å½“é“çš„æ—¶ä»£ï¼Œæˆ‘ä»¬ä¸å¯èƒ½å°†æ‰€æœ‰çš„ä»£ç éƒ½æ‰“åŒ…åœ¨ä¸€ä¸ªjsæ–‡ä»¶ä¸­ï¼Œä¹Ÿä¸å¯èƒ½åœ¨åº”ç”¨å¯åŠ¨æ—¶ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰çš„jsæ–‡ä»¶ï¼Œå¦åˆ™é•¿æ—¶é—´çš„ç™½å±ä¼šè®©ç”¨æˆ·æŠ“ç‹‚ï¼Œå¤§å¤§å½±å“ç”¨æˆ·ä½“éªŒã€‚è¿™æ—¶å¯ä»¥å°†ä»£ç è¿›è¡Œåˆ†å‰²ï¼Œä½¿å…¶å¯ä»¥å¹¶è¡ŒåŠ è½½ï¼Œä¹Ÿå¯ä»¥åœ¨ä¸åŒçš„é˜¶æ®µï¼ˆå¦‚ä¸åŒè·¯ç”±ï¼‰å»åŠ è½½æ‰€éœ€çš„ä»£ç ï¼Œè¿™å³æ˜¯ä»£ç åˆ†å‰²å’ŒæŒ‰éœ€åŠ è½½ã€‚</p>
<p>webpackå†…ç½®äº†éå¸¸å¼ºå¤§çš„ä»£ç è‡ªåŠ¨åˆ†å‰²åŠŸèƒ½ï¼Œä¹Ÿæ˜¯å®ƒæœ€å¼•äººæ³¨ç›®çš„ç‰¹æ€§ä¹‹ä¸€ï¼Œå¦‚æœåˆç†ä½¿ç”¨ï¼Œå¯ä»¥æå¤§çš„æå‡åº”ç”¨åŠ è½½æ—¶é—´ã€‚</p>
<p>å¸¸ç”¨çš„ä»£ç åˆ†ç¦»ï¼š</p>
<ul>
<li>å…¥å£chunkåˆ†å‰²ï¼šä½¿ç”¨entryé…ç½®å¤šä¸ªchunkï¼Œæ‰‹åŠ¨åˆ†ç¦»ä»£ç ã€‚</li>
<li>æå–å…¬ç”¨ä»£ç ï¼š<a href="https://webpack.docschina.org/plugins/split-chunks-plugin/"><code>SplitChunksPlugin</code></a> å»é‡å’Œåˆ†ç¦» chunkã€‚</li>
<li>åŠ¨æ€å¯¼å…¥ä¸æŒ‰éœ€åŠ è½½ï¼šé€šè¿‡æ¨¡å—ä¸­çš„å†…è”å‡½æ•°è°ƒç”¨æ¥åˆ†ç¦»ä»£ç ï¼Œç›®å‰æ¨èä½¿ç”¨<code>import()</code>è¯­æ³•ã€‚</li>
</ul>
<h4 id="å…¥å£chunkåˆ†å‰²">å…¥å£chunkåˆ†å‰²</h4>
<p>æœ€ç®€å•çš„åˆ†ç¦»æ–¹å¼å°±æ˜¯åœ¨å…¥å£æ‰‹åŠ¨å°†ä»£ç åˆ†æˆä¸åŒçš„chunkã€‚</p>
<pre><code class="language-js">// build/webpack.base.conf.js
module.exports = {
  entry: {
    app: '../src/index.js',
   	another: '../src/another-module.js'
  },
  output: {
    filename: '[name].bundle.js',
    path: path.resolve(__dirname, '../dist')
  }
};
</code></pre>
<p>æ„å»ºç»“æœï¼š</p>
<pre><code class="language-bash">...
            Asset     Size   Chunks             Chunk Names
another.bundle.js  550 KiB  another  [emitted]  another
  index.bundle.js  550 KiB    index  [emitted]  index
Entrypoint index = index.bundle.js
Entrypoint another = another.bundle.js
...
</code></pre>
<p>è¿™ç§æ–¹å¼è™½ç„¶ç®€å•ï¼Œä½†æ˜¯å­˜åœ¨ä¸€äº›é—®é¢˜ï¼š</p>
<ul>
<li>ä¾èµ–å¼€å‘è€…è‡ªå·±æ‰‹åŠ¨é…ç½®ï¼Œä¸å¤Ÿæ™ºèƒ½ã€‚</li>
<li>å¦‚æœæ¯ä¸ªå…¥å£chunkä¸­å‡åŒ…å«æœ‰æŸä¸ªæ¨¡å—ï¼Œä¸ä¼šå…±äº«ï¼Œè€Œæ˜¯ä¼šå°†è¯¥æ¨¡å—æ‰“åŒ…åˆ°å„ä¸ª bundle ä¸­ã€‚</li>
</ul>
<h4 id="æ¨¡å—å»é‡">æ¨¡å—å»é‡</h4>
<p>webpackå†…ç½®äº†<a href="https://webpack.docschina.org/plugins/split-chunks-plugin/"><code>SplitChunksPlugin</code></a>ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„æŠŠé‡å¤æ¨¡å—çš„æå–æˆå…¬å…±ä¾èµ–ï¼Œå‡å°‘æ–‡ä»¶ä½“ç§¯ã€‚è€Œä¸”å°†ä¸€äº›ç¬¬ä¸‰æ–¹ä¾èµ–ï¼ˆä¸€èˆ¬ä¸éœ€è¦é¢‘ç¹å˜åŠ¨ï¼‰æå–æˆå…¬å…±ä¾èµ–ï¼Œä¹Ÿä¾¿äºå®¢æˆ·ç«¯åšç¼“å­˜ï¼Œæ¯æ¬¡æ›´æ–°ä»£ç çš„æ—¶å€™ï¼Œç”¨æˆ·ä¸éœ€è¦é‡æ–°ä¸‹è½½è¿™äº›æ²¡å‘ç”Ÿå˜åŒ–çš„æ¨¡å—ã€‚</p>
<pre><code class="language-js">// build/webpack.base.conf.js
module.exports = {
  // ...
  entry: {
    app: '../src/index.js',
   	another: '../src/another-module.js'
  },
  output: {
    filename: '[name].bundle.js',
    path: path.resolve(__dirname, '../dist')
  },
  optimization: {
     splitChunks: { // æ·»åŠ æ­¤é…ç½®
       chunks: 'all'
     }
   }
};
</code></pre>
<p>ç°åœ¨é‡æ–°æ‰“åŒ…ï¼Œappå’Œanotherä¸­å…±ç”¨çš„æ¨¡å—å°†ä¼šæŠ½ç¦»åˆ°venderä¸­ï¼Œé¿å…äº†äº§ç”Ÿé‡å¤çš„æ¨¡å—ã€‚</p>
<pre><code class="language-bash">...
                          Asset      Size                 Chunks             Chunk Names
              another.bundle.js  5.95 KiB                another  [emitted]  another
                index.bundle.js  5.89 KiB                  index  [emitted]  index
vendors~another~index.bundle.js   547 KiB  vendors~another~index  [emitted]  vendors~another~index
Entrypoint index = vendors~another~index.bundle.js index.bundle.js
Entrypoint another = vendors~another~index.bundle.js another.bundle.js
...
</code></pre>
<p>chunkè‡ªåŠ¨æ‹†åˆ†æ˜¯webpack4.0æ”¹è¿›æœ€å¤§çš„åŠŸèƒ½ï¼Œ å¦‚æœåŒæ—¶æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼Œchunk å°±ä¼šè¢«æ‹†åˆ†ï¼š</p>
<ul>
<li>æ–°çš„ chunk è¢«å¤ç”¨ï¼Œæˆ–è€…æ¥è‡ª node_modules ç›®å½•ã€‚</li>
<li>æ–°çš„ chunk å¤§äº 30Kb(min+gzipå‰ï¼‰ã€‚</li>
<li>æŒ‰éœ€åŠ è½½ chunk çš„å¹¶å‘è¯·æ±‚æ•°é‡å°äºç­‰äº 5 ä¸ªã€‚</li>
<li>é¡µé¢åˆå§‹åŠ è½½æ—¶çš„å¹¶å‘è¯·æ±‚æ•°é‡å°äºç­‰äº 3 ä¸ªã€‚</li>
</ul>
<p><code>splitChunks</code> å®˜æ–¹é»˜è®¤é…ç½®å¦‚ä¸‹ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œä¿®æ”¹ï¼š</p>
<pre><code class="language-js">{
  optimization: {

    splitChunks: {
      chunks: &quot;async&quot;, // å¯¹å“ªäº›æ¨¡å—ä¼˜åŒ–ï¼Œå–å€¼æœ‰&quot;initial&quot;(åˆå§‹åŒ–å€¼) | &quot;all&quot;(æ‰€æœ‰ï¼Œæ¨è) | &quot;async&quot; (åŠ¨æ€å¯¼å…¥ï¼Œé»˜è®¤) | å‡½æ•°
      minSize: 30000,              // æœ€å°å°ºå¯¸ï¼Œå°äºæ­¤å€¼æ‰ä¼šåˆ†å‰²
      minChunks: 1,                // æœ€å° chunk ï¼ŒåŒ…è¢«å¼•ç”¨å‡ æ¬¡ä»¥ä¸Šæ‰ä¼šåˆ†å‰²
      maxAsyncRequests: 5,         // æŒ‰éœ€åŠ è½½çš„æœ€å¤§å¹¶è¡Œè¯·æ±‚æ•°ï¼Œ é»˜è®¤5
      maxInitialRequests: 3,       // æœ€å¤§çš„åˆå§‹åŒ–åŠ è½½æ¬¡æ•°ï¼Œé»˜è®¤3
      automaticNameDelimiter: '~', // æ‰“åŒ…åˆ†éš”ç¬¦
      name: true,       // æ‹†åˆ†å‡ºæ¥å—çš„åå­—ï¼Œé»˜è®¤ç”±å—åå’Œ hash å€¼è‡ªåŠ¨ç”Ÿæˆï¼Œæ­¤é€‰é¡¹å¯æ¥æ”¶ function
      cacheGroups: {   // è¿™é‡Œå¼€å§‹è®¾ç½®ç¼“å­˜çš„ chunks ï¼Œç¼“å­˜ç»„
        vendors: {
          test: /[\\/]node_modules[\\/]/,
          priority: -10,
        },
        default: {
          minChunks: 2,
          priority: -20,
          reuseExistingChunk: true,
        }
      }
    }
  }
}
</code></pre>
<h4 id="åŠ¨æ€å¯¼å…¥ä¸æŒ‰éœ€åŠ è½½">åŠ¨æ€å¯¼å…¥ä¸æŒ‰éœ€åŠ è½½</h4>
<p>webpackæä¾›äº†ä¸¤ç§æ–¹å¼è¿›è¡ŒåŠ¨æ€å¯¼å…¥ä»£ç ã€‚</p>
<ul>
<li><a href="https://webpack.docschina.org/api/module-methods#require-ensure"><code>require.ensure</code></a>ï¼šæ—©æœŸé—ç•™çš„æ–¹å¼ã€‚</li>
<li><a href="https://webpack.docschina.org/api/module-methods#import-"><code>import()</code> è¯­æ³•</a>ï¼šESè§„èŒƒä¸­çš„åŠ¨æ€å¯¼å…¥æ¨¡å—æ–¹æ³•ï¼ˆæ¨èï¼‰ã€‚</li>
</ul>
<p><code>import()</code>æ˜¯<a href="https://github.com/tc39/proposal-dynamic-import">ECMAScript ææ¡ˆ</a>ä¸­çš„ä¸€ä¸ªåŠ¨æ€å¯¼å…¥æ¨¡å—ï¼ˆå¼‚æ­¥æ–¹å¼ï¼‰çš„æ–¹æ³•ï¼Œwebpackåœ¨é‡åˆ°æ­¤è¯­æ³•ï¼Œä¼šä»¥å¼•å…¥çš„æ–‡ä»¶ä¸ºå…¥å£å•ç‹¬ç”Ÿæˆä¸€ä¸ªchunkï¼Œå¹¶è¾“å‡ºä¸€ä¸ªå•ç‹¬çš„bundleã€‚ä»£ç æ‰§è¡Œæ—¶ï¼Œå¹¶ä¸ä¼šåŠ è½½å…¨éƒ¨bundleï¼Œè€Œæ˜¯æ‰§è¡Œåˆ°æŸä¸ªimportçš„æ–‡ä»¶æ—¶ï¼Œæ‰ä¼šå»åŠ è½½è¯¥bundleï¼Œè¿™å³æ˜¯æŒ‰éœ€åŠ è½½çš„æµç¨‹ã€‚</p>
<p>æŒ‰éœ€åŠ è½½ä¹Ÿç§°ä¸ºâ€œæ‡’åŠ è½½â€ï¼Œæ˜¯ä¸€ç§éå¸¸å¥½çš„ä¼˜åŒ–æ–¹å¼ï¼Œå¯ä»¥å¤§å¤§æå‡åº”ç”¨çš„åˆå§‹åŠ è½½é€Ÿåº¦ï¼Œä¹Ÿå¯ä»¥å¤§å¤§ç¼©å°ç”¨æˆ·åŠ è½½æ–‡ä»¶çš„ä½“ç§¯ã€‚</p>
<p>æ¯”å¦‚ä¸€ä¸ªåº”ç”¨ï¼Œæœ‰9ä¸ªé¡µé¢æ˜¯ç®¡ç†å‘˜å¯ä»¥è®¿é—®çš„ï¼Œè€Œæ™®é€šç”¨æˆ·åªèƒ½è®¿é—®å…¶ä¸­çš„ä¸¤ä¸ªé¡µé¢ï¼Œå¦‚æœä¸é‡‡ç”¨æŒ‰éœ€åŠ è½½ï¼Œé‚£æ™®é€šç”¨æˆ·è™½ç„¶åªèƒ½è®¿é—®ä¸¤ä¸ªé¡µé¢ï¼Œä½†æ˜¯è¿˜æ˜¯ä¼šåŠ è½½æ‰€æœ‰é¡µé¢ä¾èµ–çš„æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸åˆç†çš„ã€‚</p>
<p>ç±»ä¼¼ï¼Œä¸‹é¢è¿™ä¸ªé¡µé¢ä¸éœ€è¦ä¸€å¼€å§‹å°±åŠ è½½<code>module.js</code>ï¼Œè€Œåªéœ€åœ¨æŒ‰é’®è¢«ç‚¹å‡»æ—¶æ‰åŠ è½½å¹¶æ‰§è¡Œå…¶ä¸­çš„ä»£ç ï¼Œå¯åœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„networké€‰é¡¹å¡è§‚å¯ŸåŠ è½½æƒ…å†µã€‚</p>
<pre><code class="language-js">document.getElementById('my-button').onclick = function() {
    import('./module.js').then(fn =&gt; {
        fn.default &amp;&amp; fn.default();
    });
}
</code></pre>
<p><code>module.js</code>å’Œå®ƒå†…éƒ¨ä¾èµ–çš„æ–‡ä»¶å°±ä¼šå•ç‹¬ç”Ÿæˆä¸€ä¸ªbundleï¼Œå¹¶ä¸”æ˜¯æŒ‰éœ€åŠ è½½çš„ã€‚å¦‚æœæˆ‘ä»¬æƒ³æ§åˆ¶è¾“å‡ºbundleçš„åå­—ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šchunkçš„åå­—ï¼Œéœ€è¦ä½¿ç”¨åˆ°webpackçš„é­”æ³•æ³¨é‡Šã€‚</p>
<pre><code class="language-js">document.getElementById('my-button').onclick = function() {
    import(/* webpackChunkName: &quot;moduleA&quot; */ './module.js').then(fn =&gt; { // æŒ‡å®šchunkNameä¸ºmoduleA
        fn.default &amp;&amp; fn.default();
    });
}
</code></pre>
<p><strong>æç¤ºï¼š</strong><code>import()</code>ä¼šè¿”å›ä¸€ä¸ªpromiseï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ä½¿ç”¨<code>async function</code>ä¼˜åŒ–é“¾å¼å†™æ³•ã€‚</p>
<pre><code class="language-js">document.getElementById('my-button').onclick = async function() {
    const fn = await import(/* webpackChunkName: &quot;moduleA&quot; */ './module.js')
    fn.default &amp;&amp; fn.default();
}
</code></pre>
<p>**æ‰©å±•ï¼š**é™¤äº†webpackChunkNameå¤–ï¼Œwebpackè¿˜æœ‰å¦å¤–ä¸¤ç§é­”æ³•æ³¨é‡Šç”¨æ¥åšæ¨¡å—çš„prefetchå’Œpreloadï¼Œå…·ä½“ä½¿ç”¨æ–¹æ³•å¯ä»¥æŸ¥çœ‹<a href="https://webpack.js.org/guides/code-splitting/#prefetchingpreloading-modules">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>
<p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œä»£ç åˆ†å‰²ä¹Ÿå¯ä»¥å‚è€ƒå¦‚ä¸‹åˆ†ç¦»åŸåˆ™ï¼š</p>
<ul>
<li>ä¸šåŠ¡ä»£ç å’Œç¬¬ä¸‰æ–¹ä¾èµ–åˆ†ç¦»</li>
<li>ä¸šåŠ¡ä»£ç ã€ä¸šåŠ¡å…¬å…±ä»£ç å’Œç¬¬ä¸‰æ–¹ä¾èµ–åˆ†ç¦»</li>
<li>é¦–æ¬¡åŠ è½½å’Œè®¿é—®ååŠ è½½çš„ä»£ç åˆ†ç¦»</li>
</ul>
<h3 id="å¼€å¯gzip">å¼€å¯Gzip</h3>
<p>å¦‚æœéƒ¨ç½²æœåŠ¡å™¨å¼€å¯äº†gzipï¼Œé‚£ä¹ˆå¯åˆ©ç”¨<a href="https://github.com/webpack-contrib/compression-webpack-plugin"><code>compression-webpack-plugin</code></a>ç”ŸæˆgzipåŒ…ï¼Œæ¥å‡å°‘åŠ è½½æ—¶é—´ã€‚</p>
<pre><code class="language-shell">npm i compression-webpack-plugin -D
</code></pre>
<pre><code class="language-js">// build/webpack.prod.conf.js
const CompressionWebpackPlugin = require('compression-webpack-plugin');
const productionGzipExtensions = ['js', 'css', 'json', 'txt', 'html','ico','svg'];
module.exports = {
	plugins:[
		new CompressionWebpackPlugin({
      // å¼€å¯gzipå‹ç¼©
      algorithm: 'gzip', // å‹ç¼©ç®—æ³•
      test: new RegExp('\\.(' + productionGzipExtensions.join('|') + ')$'),
      threshold: 10240, // ä»…å¤„ç†å¤§äºæ­¤å¤§å°çš„èµ„æºï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰
      minRatio: 0.8 // å‹ç¼©æ¯”å¤§äºæ­¤å€¼æ‰å¤„ç†
    })
	]
}

</code></pre>
<h3 id="ä½¿ç”¨cdn">ä½¿ç”¨CDN</h3>
<p>å°†ä¸€äº›ç¬¬ä¸‰æ–¹ä¾èµ–æ”¹ç”¨CDNå¼•å…¥ï¼Œä¹Ÿæ˜¯å¸¸ç”¨çš„ä¼˜åŒ–æ‰‹æ®µï¼Œå› ä¸ºä¸€èˆ¬ç¬¬ä¸‰æ–¹æ¨¡å—ä¸ä¼šåƒä¸šåŠ¡ä»£ç ä¸€èˆ¬é¢‘ç¹æ›´æ–°ï¼Œä½¿ç”¨CDNåï¼Œå®¢æˆ·ç«¯ä¼šç¼“å­˜è¿™äº›èµ„æºï¼Œæå‡åº”ç”¨åŠ è½½é€Ÿåº¦ã€‚ä¸ä»…å¦‚æ­¤ï¼Œè¿™äº›ä¾èµ–ä¹Ÿä¸ä¼šå‚ä¸æ„å»ºè¿‡ç¨‹ï¼ˆä¸ä¼šè¢«æ‰“åŒ…è¿›è¾“å‡ºæ–‡ä»¶ä¸­ï¼‰ï¼Œä¹Ÿå¯ä»¥æå‡æ„å»ºé€Ÿåº¦ã€‚</p>
<pre><code class="language-js">// build/webpack.base.conf.js
module.exports = {
    externals: {
        'vue': 'Vue', // é…ç½®éœ€è¦æ’é™¤çš„åŒ…åç§°
        // ...
    }
}
</code></pre>
<p>åœ¨jsä¸­è¿˜æ˜¯ä½¿ç”¨<code>import Vue from 'vue'</code>å³å¯ï¼Œä¸è¿‡åˆ«å¿˜äº†åœ¨htmlåšå¼•å…¥ã€‚</p>
<pre><code class="language-html">&lt;!-- public/index.html --&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;app&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div id=&quot;root&quot;&gt;root&lt;/div&gt;
    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/vue@2.6.11&quot;&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h2 id="æå‡æ„å»ºæ•ˆç‡">æå‡æ„å»ºæ•ˆç‡</h2>
<p>éšç€ä¸šåŠ¡å‘å±•ï¼Œæˆ‘ä»¬çš„é¡¹ç›®è§„æ¨¡å¯èƒ½è¶Šæ¥è¶Šå¤§ï¼Œä»£ç ä¹Ÿä¼šè¶Šæ¥è¶Šå¤šï¼Œå°±ä¼šè¿›å…¥æ”¹ä»£ç åç§’é’Ÿï¼Œbuildååˆ†é’Ÿçš„å°´å°¬å¢ƒåœ°ï¼ŒåŠ ç­ä»€ä¹ˆçš„éƒ½ä¸åœ¨è¯ä¸‹ã€‚æ‰€ä»¥ä¸ºäº†æœ‰æ›´å¤šçš„æ—¶é—´å’Œå¥³ç¥çº¦ä¼šï¼Œæå‡webpackæ„å»ºæ•ˆç‡å°±åŠ¿åœ¨å¿…è¡Œäº†ã€‚</p>
<p>æå‡webpackçš„æ„å»ºæ•ˆç‡æœ¬è´¨å°±æ˜¯è®©å®ƒå°‘å¹²ç‚¹æ´»ï¼Œåº”è¯¥å°½é‡é¿å…è®©å®ƒå»åšä¸€äº›ä¸å¿…è¦çš„äº‹æƒ…ã€‚å›´ç»•è¿™ä¸ªæ–¹å‘ï¼Œæˆ‘ä»¬å°±å¯ä»¥åŠ¨æ‰‹æäº‹æƒ…äº†ã€‚</p>
<h3 id="ä¼˜åŒ–resolveè§£æè§„åˆ™">ä¼˜åŒ–<code>resolve</code>è§£æè§„åˆ™</h3>
<p>å¯ä»¥é€šè¿‡ä¼˜åŒ–resolveä¸‹çš„è§£æè§„åˆ™æ¥è®©webpackæ›´åŠ å¿«é€Ÿçš„å®šä½åˆ°æŒ‡å®šçš„æ¨¡å—ï¼Œè€Œä¸ç”¨åšæ›´å¤šçš„åŒ¹é…æŸ¥è¯¢å·¥ä½œã€‚</p>
<pre><code class="language-js">// build/webpack.base.conf.js
resolve: {
  modules: [
    path.resolve(__dirname, 'node_modules'), // ä½¿ç”¨ç»å¯¹è·¯å¾„æ˜ç¡®æŒ‡å®š node_modules
  ],
  // å‡å°‘åç¼€è‡ªåŠ¨è¡¥å…¨ç±»å‹ï¼Œå‡å°‘è‡ªåŠ¨åŒ¹é…å·¥ä½œï¼Œç¼©çŸ­æ–‡ä»¶è·¯å¾„æŸ¥è¯¢çš„æ—¶é—´ï¼Œå…¶ä»–ç±»å‹çš„æ–‡ä»¶éœ€è¦åœ¨å¼•å…¥æ—¶æŒ‡å®šåç¼€å
  extensions: [&quot;.js&quot;],
  // é¿å…ä½¿ç”¨é»˜è®¤æ–‡ä»¶ï¼Œè€Œæ˜¯å¿…é¡»ä½¿ç”¨å®Œæ•´çš„è·¯å¾„
  mainFiles: ['index'],
},
</code></pre>
<h3 id="ç¼©å°æœç´¢èŒƒå›´">ç¼©å°æœç´¢èŒƒå›´</h3>
<p>å¦‚ï¼Œåœ¨loaderè§„åˆ™é…ç½®æ—¶ï¼Œä½¿ç”¨ä¸€äº›è§„åˆ™ï¼ˆincludeï¼Œexcludeç­‰ï¼‰æ¥ç¼©å°æ¨¡å—çš„æœç´¢èŒƒå›´ï¼Œæœç´¢å’Œå¤„ç†çš„æ–‡ä»¶å°‘äº†ï¼Œé€Ÿåº¦è‡ªç„¶ä¹Ÿå°±æå‡äº†ã€‚</p>
<pre><code class="language-js">// build/webpack.base.conf.js
module.exports = {
  module: {
    rules: [
      {
        test: /\.js$/,
        include: path.resolve(__dirname, 'src'), // ä»…ä»…æœç´¢srcä¸‹çš„æ–‡ä»¶ï¼Œä¸€èˆ¬node_modulesä¸­çš„æ–‡ä»¶éƒ½å·²ç¼–è¯‘å¥½ï¼Œä¸éœ€å†å¤„ç†ï¼Œéœ€è¦æ’é™¤æ‰
        loader: 'babel-loader'
      }
    ]
  }
};
</code></pre>
<h3 id="ç²¾ç®€loaderplugin">ç²¾ç®€<code>loader/plugin</code></h3>
<p>æ¯ä¸ªloader/pluginéƒ½æ˜¯éœ€è¦æ¶ˆè€—æ„å»ºæ—¶é—´çš„ï¼Œå°½é‡å‡å°‘å†—ä½™æˆ–è€…ä¸å¿…è¦çš„å·¥å…·å’Œé…ç½®ï¼Œåœ¨é€‰æ‹©è¿™äº›å·¥å…·æ—¶ä¹Ÿå°½é‡é€‰æ‹©ä¸€äº›æ€§èƒ½å¥½ä¸€ç‚¹çš„ã€‚</p>
<h3 id="ä½¿ç”¨dllplugin">ä½¿ç”¨DLLPlugin</h3>
<p><a href="https://doc.webpack-china.org/plugins/dll-plugin">DLLPlugin</a> æ˜¯ webpack å®˜æ–¹æä¾›çš„ä¸€ä¸ªæ’ä»¶ï¼Œä½¿ç”¨ <code>DllPlugin</code> ä¸ºæ›´æ”¹ä¸é¢‘ç¹çš„ä»£ç (å¦‚vueã€reactç­‰ç¬¬ä¸‰æ–¹æ¨¡å—)ç”Ÿæˆå•ç‹¬ç¼–è¯‘ç»“æœç¼“å­˜ä¸‹æ¥ï¼Œåç»­æ„å»ºç›´æ¥ä½¿ç”¨è¿™äº›æ–‡ä»¶ï¼Œé¿å…é‡å¤æ„å»ºã€‚è¿™æ ·å¯ä»¥æ˜¾è‘—æé«˜åº”ç”¨ç¨‹åºçš„ç¼–è¯‘é€Ÿåº¦ã€‚</p>
<p>éœ€è¦å…ˆåˆ©ç”¨webpackå†…ç½®æ’ä»¶<a href="https://doc.webpack-china.org/plugins/dll-plugin">DLLPlugin</a>ç”Ÿæˆèµ„æºåŠ¨æ€é“¾æ¥åº“ï¼Œç„¶åå†ä½¿ç”¨<a href="https://webpack.docschina.org/plugins/dll-plugin/#dllreferenceplugin">DLLReferencePlugin</a>å°†å¯¹åº”èµ„æºæ˜ å°„åˆ°è¿™äº›åŠ¨æ€é“¾æ¥åº“å°±å¯ä»¥äº†ï¼Œä¸è¿‡è¿™æ ·é…ç½®è¿˜æ˜¯æ¯”è¾ƒå¤æ‚çš„ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€‰æ‹© <a href="https://github.com/asfktz/autodll-webpack-plugin">AutoDllPlugin</a>ï¼Œå®ƒæ•´åˆäº†ä¸Šè¿°ä¸¤ä¸ªæ’ä»¶çš„åŠŸèƒ½ï¼Œè€Œé…ç½®æ¯”è¾ƒç®€å•ã€‚</p>
<pre><code class="language-bash">npm install --save-dev autodll-webpack-plugin
</code></pre>
<pre><code class="language-js">// build/webpack.base.conf.js
plugins: [
  //...
  new AutoDllPlugin({
    inject: true,
    filename: '[name].js',
    entry: {
      vendor: [
        'vue'
      ]
    }
  })
]
</code></pre>
<figure data-type="image" tabindex="5"><img src="https://gitee.com/letwrong/Picture/raw/master/20201028091448.png" alt="ä¼˜åŒ–å‰" loading="lazy"></figure>
<figure data-type="image" tabindex="6"><img src="https://gitee.com/letwrong/Picture/raw/master/20201028091501.png" alt="ä¼˜åŒ–å" loading="lazy"></figure>
<p>å¯ä»¥çœ‹åˆ°ä¸¤æ¬¡æ‰“åŒ…æ—¶é—´å·®åˆ«è¿˜æ˜¯æŒºå¤§çš„ï¼Œç¡®å®æ¯”è¾ƒæœ‰æ•ˆï¼Œç›®å‰ç¤ºä¾‹é¡¹ç›®æ¨¡å—è¾ƒå°‘ï¼Œåœ¨å¤§é¡¹ç›®æ•ˆæœåº”è¯¥æ›´åŠ æ˜¾è‘—ã€‚</p>
<h3 id="å°å³æ˜¯å¿«">å°å³æ˜¯å¿«</h3>
<p>ä½¿ç”¨æ•°é‡æ›´å°‘/ä½“ç§¯æ›´å°çš„ libraryï¼Œå¦‚å°†momentJSæ¢æˆdayJSï¼Œå‡å°‘ç¼–è¯‘ç»“æœçš„æ•´ä½“å¤§å°ï¼Œä»¥æé«˜æ„å»ºæ€§èƒ½ã€‚å°½é‡ä¿æŒ chunk ä½“ç§¯å°ã€‚</p>
<ul>
<li>ä½¿ç”¨æ•°é‡æ›´å°‘/ä½“ç§¯æ›´å°çš„ libraryã€‚</li>
<li>åœ¨å¤šé¡µé¢åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ <code>SplitChunksPlugin</code>ã€‚</li>
<li>åœ¨å¤šé¡µé¢åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ <code>SplitChunksPlugin </code>ï¼Œå¹¶å¼€å¯ <code>async</code> æ¨¡å¼ã€‚</li>
<li>ç§»é™¤æœªå¼•ç”¨ä»£ç ã€‚</li>
<li>åªç¼–è¯‘ä½ å½“å‰æ­£åœ¨å¼€å‘çš„é‚£äº›ä»£ç ã€‚</li>
</ul>
<h3 id="æŒä¹…åŒ–ç¼“å­˜">æŒä¹…åŒ–ç¼“å­˜</h3>
<p>ä½¿ç”¨ <code>cache-loader</code>ä¸ºæŸäº›è€—è´¹æ€§èƒ½çš„loaderå¯ç”¨æŒä¹…åŒ–ç¼“å­˜ï¼Œå¯ä»¥å‡å°‘é‡æ–°æ„å»ºæ–‡ä»¶çš„æ•°é‡ï¼Œèƒ½æœ‰æ•ˆæå‡æ„å»ºé€Ÿåº¦ã€‚</p>
<pre><code class="language-shell">npm install cache-loader -D
</code></pre>
<pre><code class="language-js">// build/webpack.base.conf.js
module.exports = {
    module: {
        rules: [{
            test: /\.jsx?$/,
            use: ['cache-loader','babel-loader'] // ä»…éœ€å°†cache-loaderæ”¾åœ¨éœ€è¦ç¼“å­˜çš„loaderå‰é¢å°±è¡Œäº†
        }]
    }
}
</code></pre>
<p>**æç¤ºï¼š**æŸäº›loaderæœ¬èº«æ˜¯æ”¯æŒé…ç½®cacheçš„ï¼Œå¯é€‰æ‹©ä½¿ç”¨loaderè‡ªå¸¦çš„ç¼“å­˜åŠŸèƒ½ã€‚å¦‚ç»™<code>babel-loader</code>çš„cacheDirectoryé…ç½®ç¼“å­˜è·¯å¾„ï¼ˆtrueæˆ–è€…ä¸è®¾ç½®è·¯å¾„åˆ™ä½¿ç”¨é»˜è®¤è·¯å¾„<code>node_modules/.cache/babel-loader</code>ï¼‰ï¼Œå³å¯å¼€å¯ç¼“å­˜ã€‚</p>
<blockquote>
<p>é™¤äº†ä½¿ç”¨loaderå¤–ï¼Œä¸€äº›æ’ä»¶ä¹Ÿå¯ä»¥æä¾›ç¼“å­˜åŠŸèƒ½ï¼Œå¦‚<a href="https://www.npmjs.com/package/hard-source-webpack-plugin">HardSourceWebpackPlugin</a> ã€‚</p>
<p>å› ä¸ºç¼“å­˜éœ€è¦å°†æ–‡ä»¶å†™å…¥åˆ°ç£ç›˜ï¼Œè€Œæ–‡ä»¶å†™å…¥ä¹Ÿæ˜¯æœ‰å¼€é”€çš„ï¼Œæ‰€ä»¥å¥½é’¢è¦ç”¨åœ¨åˆ€åˆƒä¸Šï¼Œå»ºè®®ä»…å¯¹æ¯”è¾ƒè€—è´¹æ€§èƒ½çš„loaderå¼€å¯ã€‚</p>
<p>webpack5.0å·²ç»å†…ç½®äº†<a href="https://webpack.docschina.org/configuration/other-options/#cache">æŒä¹…ç¼“å­˜æ–¹æ¡ˆ</a>ï¼Œèƒ½å¤Ÿæœ‰æ•ˆæå‡æ„å»ºé€Ÿåº¦ã€‚</p>
</blockquote>
<h3 id="å› åœ°åˆ¶å®œ">å› åœ°åˆ¶å®œ</h3>
<p>é’ˆå¯¹ä¸åŒç¯å¢ƒé€‰æ‹©åˆé€‚çš„é…ç½®ï¼Œå¦‚è®¾ç½®åˆé€‚çš„devtoolï¼ˆsource-mapï¼‰ï¼Œå¼€å‘ç¯å¢ƒä¸è¿›è¡Œä»£ç å‹ç¼©ä¼˜åŒ–ç­‰ã€‚</p>
<h3 id="å¼€å¯å¤šè¿›ç¨‹">å¼€å¯å¤šè¿›ç¨‹</h3>
<p><code>thread-loader</code> å¯ä»¥ç®¡ç†å¤šä¸ªè¿›ç¨‹ï¼Œå¯å°†éå¸¸æ¶ˆè€—èµ„æºçš„ loader åˆ†é…ç»™ä¸€ä¸ª workerè¿›ç¨‹ï¼Œä»è€Œå‡å°‘ä¸»è¿›ç¨‹çš„æ€§èƒ½å¼€é”€ã€‚</p>
<pre><code class="language-shell">npm install thread-loader -D
</code></pre>
<pre><code class="language-js">// build/webpack.base.conf.js
module.exports = {
    module: {
        rules: [
            {
                test: /\.jsx?$/,
                use: ['thread-loader', 'babel-loader'] // ä»…éœ€åœ¨å¯¹åº”çš„loaderå‰é¢æ·»åŠ thread-loaderå³å¯
            }
        ]
    }
}
</code></pre>
<blockquote>
<p><em>ä¸è¦ä½¿ç”¨å¤ªå¤šçš„ workerï¼Œå› ä¸º Node.js çš„ runtime å’Œ loader éƒ½æœ‰å¯åŠ¨å¼€é”€ã€‚è¦æœ€å°åŒ– worker å’Œ main process(ä¸»è¿›ç¨‹) ä¹‹é—´çš„æ•°æ®ä¼ è¾“ï¼Œå› ä¸ºè¿›ç¨‹é—´é€šè®¯(IPC, inter process communication)ä¹Ÿæ˜¯éå¸¸æ¶ˆè€—èµ„æºçš„ã€‚</em></p>
<p>é™¤äº†<code>thread-loader</code>ï¼ŒHappyPackä¹Ÿå¯ä»¥å¼€å¯å¤šè¿›ç¨‹ï¼Œä¸è¿‡é…ç½®æ›´åŠ å¤æ‚ä¸€ç‚¹ï¼Œå› ä¸ºä¸å†ç»´æŠ¤ï¼Œå›ºä¸æ¨èä½¿ç”¨ã€‚</p>
<p>ç°åœ¨webpackå†…ç½®JSå‹ç¼©ä½¿ç”¨äº†TerserWebpackPluginï¼Œæœ¬èº«å·²å¼€å¯å¤šè¿›ç¨‹ï¼Œå›ºä¸å†éœ€è¦æ‰‹åŠ¨å¼€å¯ã€‚</p>
</blockquote>
<p>é™¤äº†ä»¥ä¸Šæ‰‹æ®µï¼Œwebpackå’ŒnodeJSæ¯ä¸ªç‰ˆæœ¬è¿­ä»£ä¹Ÿä¼šå¤§å¹…æå‡æ€§èƒ½ï¼ŒåŠæ—¶å‡çº§å·¥å…·ä¹Ÿæ˜¯æå‡æ„å»ºæ•ˆç‡çš„æœ‰æ•ˆæ‰‹æ®µã€‚æ›´å¤šçš„æ€§èƒ½ä¼˜åŒ–æ‰‹æ®µå¯ä»¥æŸ¥çœ‹<a href="https://webpack.docschina.org/guides/build-performance/">å®˜æ–¹æ–‡æ¡£-æ„å»ºæ€§èƒ½</a>ã€‚</p>
<h1 id="ä¿®ç‚¼å†…åŠŸ-åŸç†">ä¿®ç‚¼å†…åŠŸ-åŸç†</h1>
<h2 id="å·¥ä½œåŸç†">å·¥ä½œåŸç†</h2>
<h3 id="è¿è¡Œæµç¨‹">è¿è¡Œæµç¨‹</h3>
<p>webpackè¿è¡Œæµç¨‹æ˜¯ä¸²è¡Œæ–¹å¼çš„ï¼Œå¤§è‡´å¦‚ä¸‹ï¼š</p>
<ol>
<li>åˆå§‹åŒ–å‚æ•°ï¼šä»é…ç½®æ–‡ä»¶å’Œ Shell è¯­å¥ä¸­è¯»å–ä¸åˆå¹¶å‚æ•°é…ç½®ï¼Œå¾—å‡ºæœ€ç»ˆçš„å‚æ•°é…ç½®ï¼›</li>
<li>å¼€å§‹ç¼–è¯‘ï¼šç”¨ä¸Šä¸€æ­¥å¾—åˆ°çš„å‚æ•°é…ç½®åˆå§‹åŒ– Compiler å¯¹è±¡ï¼ŒåŠ è½½æ‰€æœ‰é…ç½®çš„æ’ä»¶ï¼Œæ‰§è¡Œå¯¹è±¡çš„ run æ–¹æ³•å¼€å§‹æ‰§è¡Œç¼–è¯‘ï¼›</li>
<li>ç¡®å®šå…¥å£ï¼šæ ¹æ®é…ç½®ä¸­çš„ entry æ‰¾å‡ºæ‰€æœ‰çš„å…¥å£æ–‡ä»¶ï¼›</li>
<li>ç¼–è¯‘æ¨¡å—ï¼šä»å…¥å£æ–‡ä»¶å‡ºå‘ï¼Œè°ƒç”¨æ‰€æœ‰é…ç½®çš„ Loader å¯¹æ¨¡å—è¿›è¡Œç¿»è¯‘ï¼Œå†æ‰¾å‡ºè¯¥æ¨¡å—ä¾èµ–çš„æ¨¡å—ï¼Œå†é€’å½’æœ¬æ­¥éª¤ã€‚ç›´åˆ°æ‰€æœ‰å…¥å£ä¾èµ–çš„æ–‡ä»¶éƒ½ç»è¿‡äº†æœ¬æ­¥éª¤çš„å¤„ç†ï¼›</li>
<li>å®Œæˆæ¨¡å—ç¼–è¯‘ï¼šåœ¨ç»è¿‡ç¬¬4æ­¥ä½¿ç”¨ Loader ç¿»è¯‘å®Œæ‰€æœ‰æ¨¡å—åï¼Œå¾—åˆ°äº†æ¯ä¸ªæ¨¡å—è¢«ç¿»è¯‘åçš„æœ€ç»ˆå†…å®¹ä»¥åŠå®ƒä»¬ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼›</li>
<li>è¾“å‡ºèµ„æºï¼šæ ¹æ®å…¥å£å’Œæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œç»„è£…æˆä¸€ä¸ªä¸ªåŒ…å«å¤šä¸ªæ¨¡å—çš„ Chunkï¼Œå†æŠŠæ¯ä¸ª Chunk è½¬æ¢æˆä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶åŠ å…¥åˆ°è¾“å‡ºåˆ—è¡¨ï¼Œè¿™æ­¥æ˜¯å¯ä»¥ä¿®æ”¹è¾“å‡ºå†…å®¹çš„æœ€åæœºä¼šï¼›</li>
<li>è¾“å‡ºå®Œæˆï¼šåœ¨ç¡®å®šå¥½è¾“å‡ºå†…å®¹åï¼Œæ ¹æ®é…ç½®ç¡®å®šè¾“å‡ºçš„è·¯å¾„å’Œæ–‡ä»¶åï¼ŒæŠŠæ–‡ä»¶å†…å®¹å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿã€‚</li>
</ol>
<p><strong>æç¤ºï¼šåœ¨ä»¥ä¸Šçš„è¿‡ç¨‹ä¸­ï¼Œwebpackä¼šåœ¨ç‰¹å®šçš„æ—¶æœºå¹¿æ’­å‡ºå¯¹åº”çš„äº‹ä»¶ï¼Œæ–¹ä¾¿è§¦å‘æ’ä»¶ä¸­ç›‘å¬äº†è¿™äº›äº‹ä»¶çš„é’©å­è¿è¡Œã€‚</strong></p>
<p>çœ‹ä¼¼æµç¨‹è¾ƒå¤šï¼Œæˆ‘ä»¬å¯ä»¥ç²¾ç®€ä¸€ä¸‹ï¼š</p>
<ol>
<li>
<p>åˆå§‹åŒ–ï¼šå¯åŠ¨æ„å»ºï¼Œè¯»å–ä¸åˆå¹¶é…ç½®å‚æ•°ï¼ŒåŠ è½½ Pluginï¼Œå®ä¾‹åŒ– Compilerã€‚</p>
</li>
<li>
<p>ç¼–è¯‘ï¼šä» Entry å‘å‡ºï¼Œé’ˆå¯¹æ¯ä¸ª Module ä¸²è¡Œè°ƒç”¨å¯¹åº”çš„ Loader å»ç¿»è¯‘æ–‡ä»¶å†…å®¹ï¼Œå†æ‰¾åˆ°è¯¥ Module ä¾èµ–çš„ Moduleï¼Œé€’å½’åœ°è¿›è¡Œç¼–è¯‘å¤„ç†ã€‚</p>
</li>
<li>
<p>è¾“å‡ºï¼šå¯¹ç¼–è¯‘åçš„ Module ç»„åˆæˆ Chunkï¼ŒæŠŠ Chunk è½¬æ¢æˆæ–‡ä»¶ï¼Œè¾“å‡ºåˆ°æ–‡ä»¶ç³»ç»Ÿã€‚</p>
<figure data-type="image" tabindex="7"><img src="https://gitee.com/letwrong/Picture/raw/master/20200705214253.png" alt="" loading="lazy"></figure>
</li>
</ol>
<p>å‚è€ƒèµ„æ–™ï¼š<a href="%5Bhttp://www.xbhub.com/wiki/webpack/5%E5%8E%9F%E7%90%86/5-1%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E6%A6%82%E6%8B%AC.html%5D(http://www.xbhub.com/wiki/webpack/5%E5%8E%9F%E7%90%86/5-1%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E6%A6%82%E6%8B%AC.html)">webpackå·¥ä½œåŸç†æ¦‚æ‹¬</a></p>
<h3 id="å®ç°ä¸€ä¸ªç®€å•çš„webpack">å®ç°ä¸€ä¸ªç®€å•çš„webpack</h3>
<p>ä¿—è¯è¯´ï¼šè¯»ä¸‡å·ä¹¦ä¸å¦‚è¡Œä¸‡é‡Œè·¯ï¼Œè®²å†å¤šçš„åŸç†éƒ½ä¸å¦‚æ•²æ•²ä»£ç æ¥å¾—å®åœ¨ã€‚ä¸‹é¢æˆ‘ä»¬å°±ä¸€æ­¥ä¸€æ­¥å®ç°ä¸€ä¸ªç®€å•çš„æ‰“åŒ…å™¨ã€‚</p>
<h4 id="å‡†å¤‡å·¥ä½œ">å‡†å¤‡å·¥ä½œ</h4>
<p>åˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼ŒåŒ…å«å¦‚ä¸‹æ–‡ä»¶åŠæ–‡ä»¶å¤¹ï¼š</p>
<figure data-type="image" tabindex="8"><img src="https://gitee.com/letwrong/Picture/raw/master/20200705215338.png" alt="image-20200705215338484" loading="lazy"></figure>
<pre><code class="language-js">// /src/index.js
import a from './a.js';

console.log(a);
</code></pre>
<pre><code class="language-js">// /src/a.js
import b from './b.js';
const a = `b content: ${b}`;
export default a;
</code></pre>
<pre><code class="language-js">// /src/b.js
const b = 'Im B';
export default b;
</code></pre>
<p>ç°åœ¨è¿™æ ·çš„ä»£ç åœ¨ä¸æ”¯æŒESModuleçš„æµè§ˆå™¨æ˜¯ä¸èƒ½è¿è¡Œçš„ï¼Œéœ€è¦ä½¿ç”¨æ‰“åŒ…å™¨è¿›è¡Œè½¬æ¢æ‰è¡Œï¼Œé©¬ä¸Šå¼€æ’¸ã€‚</p>
<h4 id="å®ç°æ¨¡å—æ‰“åŒ…">å®ç°æ¨¡å—æ‰“åŒ…</h4>
<p>åœ¨å¼€æ’¸å‰ï¼Œæˆ‘ä»¬æ˜ç¡®ä¸‹æ‰“åŒ…çš„ç›®æ ‡å’Œæµç¨‹ï¼š</p>
<ol>
<li>æ‰¾åˆ°é¡¹ç›®å…¥å£ï¼ˆå³<code>/src/index.js</code>ï¼‰ï¼Œå¹¶è¯»å–å…¶å†…å®¹ï¼›</li>
<li>åˆ†æå…¥å£æ–‡ä»¶å†…å®¹ï¼Œé€’å½’å¯»æ‰¾å…¶ä¾èµ–ï¼Œç”Ÿæˆä¾èµ–å…³ç³»å›¾ï¼›</li>
<li>æ ¹æ®ç”Ÿæˆçš„ä¾èµ–å…³ç³»å›¾ï¼Œç¼–è¯‘å¹¶ç”Ÿæˆæœ€ç»ˆè¾“å‡ºä»£ç </li>
</ol>
<p><code>/myBundle.js</code>å³ä¸ºæˆ‘ä»¬çš„æ‰“åŒ…å™¨ï¼Œæ‰€æœ‰ç›¸å…³çš„ä»£ç ä¹Ÿå°†å†™åœ¨å…¶ä¸­ï¼Œä¸‹é¢å¼€å§‹å§ï¼</p>
<h5 id="1-è·å–æ¨¡å—å†…å®¹">1. è·å–æ¨¡å—å†…å®¹</h5>
<p>è¯»å–å…¥å£æ–‡ä»¶çš„å†…å®¹ï¼Œè¿™ä¸ªå¾ˆç®€å•ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–¹æ³•<code>getModuleInfo</code>ï¼Œä½¿ç”¨<code>fs</code>æ¥è¯»å–æ–‡ä»¶å†…å®¹ï¼š</p>
<pre><code class="language-js">// myBundle.js
const fs = require('fs')
const getModuleInfo = file =&gt; {
    const content = fs.readFileSync(file, 'utf-8')
    console.log(content)
}
getModuleInfo('./src/index.js')
</code></pre>
<p>æ¯«æ— ç–‘é—®ï¼Œè¿™é‡Œä¼šè¾“å‡º<code>index.js</code>æ–‡ä»¶çš„å†…å®¹ï¼Œä¸è¿‡å®ƒæ˜¯ä¸€å †å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬å¦‚ä½•æ‰èƒ½çŸ¥é“å®ƒä¾èµ–äº†å“ªäº›æ¨¡å—å‘¢ï¼Ÿæœ‰å¦‚ä¸‹ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li>æ­£åˆ™ï¼šé€šè¿‡æ­£åˆ™åŒ¹é…'import'å…³é”®å­—æ¥è·å–ç›¸åº”çš„æ–‡ä»¶è·¯å¾„ï¼Œä¸è¿‡å¤ªéº»çƒ¦äº†ï¼Œè¿˜ä¸å¯é ï¼Œä¸‡ä¸€ä»£ç é‡Œé¢æœ‰ä¸ªå­—ç¬¦ä¸²ä¹Ÿæœ‰è¿™äº›å†…å®¹å‘¢ï¼Ÿ</li>
<li>babelï¼šå¯ä»¥é€šè¿‡<code>@babel/parser</code>æ¥å°†ä»£ç è½¬æ¢æˆASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼ŒAbstract Syntax Tree, ç®€ç§°ASTï¼‰ï¼Œå†æ¥åˆ†æASTæŸ¥æ‰¾ä¾èµ–ã€‚çœ‹èµ·æ¥è¿™ç§æ¯”è¾ƒé è°±ã€‚</li>
</ul>
<p>æ¯«æ— ç–‘é—®ï¼Œä½¿ç”¨ç¬¬äºŒç§æ–¹å¼ã€‚</p>
<pre><code class="language-shell">npm i @babel/parser ## å®‰è£… @babel/parser
</code></pre>
<pre><code class="language-js">// myBundle.js
const fs = require('fs')
const parser = require('@babel/parser')
const getModuleInfo = file =&gt; {
    const content = fs.readFileSync(file, 'utf-8')
    const ast = parser.parse(content, {
       sourceType: 'module' // è§£æESModuleé¡»é…ç½®
    })
    console.log(ast)
    console.log(ast.program.body)
}
getModuleInfo('./src/index.js')
</code></pre>
<p>è½¬æ¢ç»“æœå¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°ä¸€å…±ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œ<code>type</code>å±æ€§æ ‡è¯†äº†èŠ‚ç‚¹çš„ç±»å‹ï¼Œ<code>ImportDeclaration</code>å³å¯¹åº”äº†<code>import</code>è¯­å¥ï¼Œè€Œå…¶<code>source.value</code>å³æ˜¯å¼•å…¥æ¨¡å—çš„ç›¸å¯¹è·¯å¾„ã€‚æƒ³è¦çš„æ•°æ®éƒ½æœ‰ï¼Œæ˜¯ä¸æ˜¯å¾ˆèµï¼</p>
<figure data-type="image" tabindex="9"><img src="https://gitee.com/letwrong/Picture/raw/master/20200705223745.png" alt="image-20200705223745187" loading="lazy"></figure>
<h5 id="2-ç”Ÿæˆä¾èµ–å…³ç³»è¡¨">2. ç”Ÿæˆä¾èµ–å…³ç³»è¡¨</h5>
<p>æœ‰äº†ä¸Šä¸€æ­¥çš„æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦å°†å®ƒä»¬ç”Ÿæˆä¸€ä»½ç»“æ„åŒ–çš„ä¾èµ–è¡¨ï¼Œæ–¹ä¾¿åç»­å¯¹ä»£ç å¤„ç†ã€‚</p>
<p>å…¶å®å°±æ˜¯éå†<code>ast.program.body</code>ï¼Œå°†å…¶ä¸­çš„<code>ImportDeclaration</code>ç±»å‹çš„èŠ‚ç‚¹æå–å‡ºæ¥ï¼Œå¹¶å­˜å…¥ä¾èµ–è¡¨ã€‚</p>
<p>è¿™é‡Œä¹Ÿä¸éœ€è¦è‡ªå·±æ‰‹åŠ¨å®ç°ç»†èŠ‚ï¼Œç›´æ¥ä½¿ç”¨<code>@babel/traverse</code>å³å¯ã€‚</p>
<pre><code class="language-shell">npm i  @babel/traverse ## å®‰è£…@babel/traverse
</code></pre>
<p><code>getModuleInfo</code>æ–¹æ³•åšå¦‚ä¸‹ä¿®æ”¹ï¼š</p>
<pre><code class="language-js">// myBundle.js
const fs = require('fs')
const path = require('path')
const parser = require('@babel/parser')
const traverse = require('@babel/traverse').default
const getModuleInfo = (file) =&gt; {
	const content = fs.readFileSync(file, 'utf-8');
	const ast = parser.parse(content, {
		sourceType: 'module'
	});
  	const dependencies = {}; // ç”¨äºå­˜å‚¨ä¾èµ–
    traverse(ast, {
        ImportDeclaration({ node }) { // åªå¤„ç†ImportDeclarationç±»å‹çš„èŠ‚ç‚¹
            const dirname = path.dirname(file);
            const newFile = '.'+ path.sep + path.join(dirname, node.source.value); // æ­¤å¤„å°†ç›¸å¯¹è·¯å¾„è½¬åŒ–ä¸ºç»å¯¹è·¯å¾„ï¼Œ
            dependencies[node.source.value] = newFile;
        }
  	});
  	console.log(dependencies);
};
getModuleInfo('./src/index.js')
</code></pre>
<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure data-type="image" tabindex="10"><img src="https://gitee.com/letwrong/Picture/raw/master/20200705230404.png" alt="image-20200705230403954" loading="lazy"></figure>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥è¿”å›ä¸€ä¸ªå®Œæ•´çš„æ¨¡å—ä¿¡æ¯äº†ã€‚</p>
<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é¡ºä¾¿é€šè¿‡<code>babel</code>çš„å·¥å…·ï¼ˆ``@babel/core<code>ï¼Œ</code>@babel/preset-env`ï¼‰å°†ä»£ç è½¬æ¢æˆES5çš„è¯­æ³•ã€‚</p>
<pre><code class="language-shell">npm i @babel/core @babel/preset-env ## å®‰è£…@babel/core @babel/preset-env
</code></pre>
<pre><code class="language-js">// myBundle.js
const fs = require('fs');
const path = require('path');
const parser = require('@babel/parser');
const traverse = require('@babel/traverse').default;
const babel = require('@babel/core');

const getModuleInfo = (file) =&gt; {
	const content = fs.readFileSync(file, 'utf-8');
	const ast = parser.parse(content, {
		sourceType: 'module'
  });
  const dependencies = {};
	traverse(ast, {
		ImportDeclaration({ node }) {
			const dirname = path.dirname(file);
			const newFile = '.'+ path.sep + path.join(dirname, node.source.value);
			dependencies[node.source.value] = newFile; // ä½¿ç”¨æ–‡ä»¶ç›¸å¯¹è·¯å¾„ä¸ºkeyï¼Œç»å¯¹è·¯å¾„ä¸ºvalue
		}
  });
  const { code } = babel.transformFromAst(ast, null, {
		presets: ['@babel/preset-env']
  });
  const moduleInfo = { file, dependencies, code };
  console.log(moduleInfo);
	return moduleInfo;
};

getModuleInfo('./src/index.js');
</code></pre>
<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure data-type="image" tabindex="11"><img src="https://gitee.com/letwrong/Picture/raw/master/20200705231115.png" alt="image-20200705231114976" loading="lazy"></figure>
<p>ç°åœ¨ï¼Œæ¨¡å—çš„ä»£ç å°±å·²ç»è½¬æ¢æˆäº†ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«æ¨¡å—çš„ç»å¯¹è·¯å¾„ã€ä¾èµ–ä»¥åŠè¢«babelè½¬æ¢åçš„ä»£ç ï¼Œä¸è¿‡ä¸Šé¢åªå¤„ç†äº†<code>index.js</code>çš„ä¾èµ–ï¼Œ<code>a.js</code>çš„ä¾èµ–å¹¶æ²¡æœ‰è¿›è¡Œå¤„ç†ï¼Œæ‰€ä»¥å¹¶ä¸æ˜¯ä¸€ä»½å®Œæ•´çš„ä¾èµ–è¡¨ï¼Œæˆ‘ä»¬éœ€è¦è¿›ä¸€æ­¥å¤„ç†ã€‚</p>
<p>å…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯ä»å…¥å£å¼€å§‹ï¼Œæ¯ä¸ªæ¨¡å—åŠå…¶ä¾èµ–éƒ½è°ƒç”¨ä¸€ä¸‹<code>getModuleInfo</code>æ–¹æ³•è¿›è¡Œåˆ†æï¼Œæœ€ç»ˆå°±ä¼šè¿”å›ä¸€ä¸ªå®Œæ•´çš„ä¾èµ–è¡¨(ä¹Ÿæœ‰äººå«ä¾èµ–å›¾ï¼Œdependency graph)ã€‚</p>
<p>æˆ‘ä»¬ç›´æ¥æ–°å†™ä¸€ä¸ªæ–¹æ³•æ¥å¤„ç†ï¼š</p>
<pre><code class="language-js">// myBundle.js
const generDepsGraph = (entry) =&gt; {
	const entryModule = getModuleInfo(entry);
	const graphArray = [ entryModule ];
	for(let i = 0; i &lt; graphArray.length; i++) {
		const item = graphArray[i];
		const { dependencies } = item;
		if(dependencies) {
			for(let j in dependencies) {
				graphArray.push(
					getModuleInfo(dependencies[j])
				);
			}
		}
	}
	const graph = {};
	graphArray.forEach(item =&gt; {
		graph[item.file] = {
			dependencies: item.dependencies,
			code: item.code
		};
	});
	return graph;
};
</code></pre>
<figure data-type="image" tabindex="12"><img src="https://gitee.com/letwrong/Picture/raw/master/20200705232430.png" alt="image-20200705232430595" loading="lazy"></figure>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å°±ç”Ÿæˆä¸€ä»½å®Œæ•´çš„ä¾èµ–è¡¨äº†ï¼Œæ¥ä¸‹æ¥ï¼Œå°±å¯ä»¥æ ¹æ®è¿™ä»½æ•°æ®æ¥ç”Ÿæˆæœ€ç»ˆçš„ä»£ç äº†ã€‚</p>
<h5 id="3ç”Ÿæˆè¾“å‡ºä»£ç ">3.ç”Ÿæˆè¾“å‡ºä»£ç </h5>
<p>åœ¨ç”Ÿæˆä»£ç å‰ï¼Œæˆ‘ä»¬å…ˆè§‚å¯Ÿä¸€ä¸‹ä¸Šé¢çš„ä»£ç ï¼Œå¯ä»¥å‘ç°é‡Œé¢åŒ…å«äº†<code>export</code>å’Œ<code>require</code>è¿™æ ·çš„<code>commonjs</code>çš„è¯­æ³•ï¼Œè€Œæˆ‘ä»¬çš„è¿è¡Œç¯å¢ƒï¼ˆè¿™é‡Œæ˜¯æµè§ˆå™¨ï¼‰æ˜¯ä¸æ”¯æŒè¿™ç§è¯­æ³•çš„ï¼Œæ‰€ä»¥è¿˜éœ€è¦è‡ªå·±æ¥å®ç°ä¸€ä¸‹è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚å…ˆè´´ä¸Šä»£ç ï¼Œå†æ…¢æ…¢é“æ¥ï¼š</p>
<p>æ–°å»ºä¸€ä¸ªbuildæ–¹æ³•ï¼Œç”¨æ¥ç”Ÿæˆè¾“å‡ºçš„ä»£ç ã€‚</p>
<pre><code class="language-js">// myBundle.js
const build = (entry) =&gt; {
	const graph = JSON.stringify(generDepsGraph(entry));
	return `
		(function(graph){
			function require(module) {
				var exports = {};
				return exports;
			};
			require('${entry}')
		})(${graph});
	`;
};

const code = build('./src/index.js');
</code></pre>
<p>è¯´æ˜ï¼š</p>
<ul>
<li>ç¬¬ä¸‰è¡Œ<code>JSON.stringify</code>æ˜¯å°†æ•°æ®å­—ç¬¦ä¸²åŒ–ï¼Œå¦åˆ™åœ¨ä¸‹é¢çš„ç«‹å³æ‰§è¡Œå‡½æ•°ä¸­æ¥æ”¶åˆ°çš„å°†æ˜¯<code>[object object]</code>ï¼Œå› ä¸ºä¸‹é¢æ˜¯åœ¨å­—ç¬¦ä¸²æ¨¡æ¿ä¸­ä½¿ç”¨ï¼Œä¼šå‘ç”Ÿç±»å‹è½¬æ¢ã€‚</li>
<li>è¿”å›çš„ä»£ç åŒ…è£¹åœ¨IIFEï¼ˆç«‹å³æ‰§è¡Œå‡½æ•°ï¼‰ä¸­æ˜¯é˜²æ­¢æ¨¡å—é—´ä½œç”¨åŸŸç›¸äº’æ±¡æŸ“ã€‚</li>
<li><code>require</code>å‡½æ•°éœ€è¦å®šä¹‰åœ¨è¾“å‡ºçš„å†…å®¹ä¸­ï¼Œè€Œä¸æ˜¯å½“å‰çš„è¿è¡Œç¯å¢ƒä¸­ï¼Œå› ä¸ºå®ƒä¼šåœ¨ç”Ÿæˆçš„ä»£ç ä¸­æ‰§è¡Œã€‚</li>
</ul>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦æ‹¿åˆ°å…¥å£æ–‡ä»¶çš„codeï¼Œå¹¶ä½¿ç”¨<code>eval</code>å‡½æ•°æ¥æ‰§è¡Œå®ƒï¼š</p>
<pre><code class="language-js">// myBundle.js
const build = (entry) =&gt; {
	const graph = JSON.stringify(generDepsGraph(entry));
	return `
		(function(graph){
			function require(module) {
				var exports = {};
				(function(require, exports, code){
					eval(code)
				})(require, exports, graph[module].code);
				return exports;
			};
			require('${entry}')
		})(${graph});
	`;
};

const code = build('./src/index.js');
console.log(code);
</code></pre>
<p>è¯´æ˜ï¼š</p>
<ul>
<li>ä¸ºäº†é˜²æ­¢codeä¸­çš„ä»£ç å’Œæˆ‘ä»¬è¿™é‡Œï¼ˆreturnçš„å­—ç¬¦ä¸²ä¸­ï¼‰ä½œç”¨åŸŸæœ‰å†²çªï¼Œæˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨IIFEåŒ…è£¹ï¼Œå¹¶å°†éœ€è¦çš„å‚æ•°ä¼ é€’è¿›å»ã€‚</li>
<li><code>graph[module].code</code>å¯ä»¥ä»ä¸Šé¢çš„ä¾èµ–è¡¨ä¸­è·å–åˆ°å…¥å£çš„ä»£ç ã€‚</li>
</ul>
<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure data-type="image" tabindex="13"><img src="https://gitee.com/letwrong/Picture/raw/master/20200706091126.png" alt="image-20200706091126005" loading="lazy"></figure>
<p>è¿™å°±æ˜¯æ‰“åŒ…çš„æˆæœäº†ï¼Œä¸è¿‡å…ˆä¸è¦é«˜å…´è¿‡å¤´äº†ï¼Œè¿™é‡Œè¿˜æœ‰ä¸€ä¸ªå¤§å‘ã€‚</p>
<p>æˆ‘ä»¬ç°åœ¨ç”Ÿæˆçš„ä»£ç ä¸­å¼•å…¥æ¨¡å—çš„æ–¹å¼éƒ½æ˜¯åŸºäº'index.js'çš„ç›¸å¯¹è·¯å¾„ï¼Œå¦‚æœåœ¨å…¶ä»–æ¨¡å—å¼•å…¥çš„æ¨¡å—è·¯å¾„å’Œç›¸è¾ƒäº<code>index.js</code>ä¸ä¸€è‡´çš„æ—¶å€™ï¼Œå¯¹åº”çš„æ¨¡å—å°±ä¼šæ‰¾ä¸åˆ°(è·¯å¾„ä¸æ­£ç¡®)ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜è¦å¤„ç†ä¸€ä¸‹æ¨¡å—çš„è·¯å¾„ã€‚å¥½åœ¨å‰é¢ä¾èµ–è¡¨çš„<code>dependencies</code>å±æ€§é‡Œé¢è®°å½•äº†æ¨¡å—çš„ç»å¯¹è·¯å¾„ï¼Œåªéœ€è¦æ‹¿å‡ºæ¥ä½¿ç”¨å³å¯ã€‚</p>
<p>æ·»åŠ ä¸€ä¸ª<code>localRequire</code>å‡½æ•°ï¼Œç”¨æ¥ä»<code>dependencies</code>ä¸­è·å–æ¨¡å—ç»å¯¹è·¯å¾„ã€‚</p>
<pre><code class="language-js">// myBundle.js
const build = (entry) =&gt; {
	const graph = JSON.stringify(generDepsGraph(entry));
	return `
		(function(graph){
			function require(module) {
				function localRequire(relativePath) {
					return require(graph[module].dependencies[relativePath]);
				}
				var exports = {};
				(function(require, exports, code){
					eval(code)
				})(localRequire, exports, graph[module].code);
				return exports;
			};
			require('${entry}')
		})(${graph});
	`;
};
</code></pre>
<p>æ¥ä¸‹æ¥ï¼Œå°†è¾“å‡ºçš„ä»£ç å†™å…¥åˆ°æ–‡ä»¶å°±å¯ä»¥äº†ã€‚</p>
<pre><code class="language-js">// myBundle.js
const code = build('./src/index.js')
fs.mkdirSync('./dist')
fs.writeFileSync('./dist/bundle.js', code)
</code></pre>
<p>æœ€åï¼Œåœ¨htmlä¸­å¼•å…¥ä¸€ä¸‹ï¼Œæµ‹è¯•ä¸€ä¸‹æ˜¯å¦èƒ½å¤Ÿæ­£å¸¸è¿è¡Œã€‚æ²¡æœ‰ç–‘é—®ï¼Œè‚¯å®šæ˜¯å¯ä»¥æ­£å¸¸è¿è¡Œçš„ã€‚ğŸ˜„ğŸ˜„</p>
<figure data-type="image" tabindex="14"><img src="https://gitee.com/letwrong/Picture/raw/master/20200706092931.png" alt="image-20200706092931226" loading="lazy"></figure>
<p>æœ€åè´´ä¸€ä¸‹å®Œæ•´çš„ä»£ç ï¼š     ğŸ®ğŸ»</p>
<pre><code class="language-js">// myBundle.js
const fs = require('fs');
const path = require('path');
const parser = require('@babel/parser');
const traverse = require('@babel/traverse').default;
const babel = require('@babel/core');

const getModuleInfo = (file) =&gt; {
	const content = fs.readFileSync(file, 'utf-8');
	const ast = parser.parse(content, {
		sourceType: 'module'
  });
  const dependencies = {};
	traverse(ast, {
		ImportDeclaration({ node }) {
			const dirname = path.dirname(file);
			const newFile = '.'+ path.sep + path.join(dirname, node.source.value);
			dependencies[node.source.value] = newFile;
		}
  });
  const { code } = babel.transformFromAst(ast, null, {
		presets: ['@babel/preset-env']
  });
  const moduleInfo = { file, dependencies, code };
	return moduleInfo;
};

const generDepsGraph = (entry) =&gt; {
	const entryModule = getModuleInfo(entry);
	const graphArray = [ entryModule ];
	for(let i = 0; i &lt; graphArray.length; i++) {
		const item = graphArray[i];
		const { dependencies } = item;
		if(dependencies) {
			for(let j in dependencies) {
				graphArray.push(
					getModuleInfo(dependencies[j])
				);
			}
		}
	}
	const graph = {};
	graphArray.forEach(item =&gt; {
		graph[item.file] = {
			dependencies: item.dependencies,
			code: item.code
		};
	});
	return graph;
};
const build = (entry) =&gt; {
	const graph = JSON.stringify(generDepsGraph(entry));
	return `
		(function(graph){
			function require(module) {
				function localRequire(relativePath) {
					return require(graph[module].dependencies[relativePath]);
				}
				var exports = {};
				(function(require, exports, code){
					eval(code)
				})(localRequire, exports, graph[module].code);
				return exports;
			};
			require('${entry}')
		})(${graph});
	`;
};

const code = build('./src/index.js');
fs.mkdirSync('./dist');
fs.writeFileSync('./dist/bundle.js', code);
</code></pre>
<p>åœ¨å®Œæˆè¿™ä¸ªæ¡ˆä¾‹ä¹‹å‰ï¼Œwebpackå°±åƒä¸€ä½é«˜è´µçš„ç¾äººï¼Œè®©äººæ•¬è€Œè¿œä¹‹ã€‚è€Œé€šè¿‡è¿™ä¸ªæ¡ˆä¾‹ï¼Œæˆ‘ä»¬æ’•ä¸‹äº†å¥¹ç¥ç§˜çš„å¤–è¡£ï¼Œå‘ç°é‡Œé¢åŸæ¥å¦‚æ­¤ç¾å¦™ï¼Œæ˜¯ä¸æ˜¯ç¾ä¸èƒœæ”¶ã€‚å½“ç„¶å®é™…ä¸èƒ½å¦‚æ­¤ç®€å•ï¼Œè¦å»å¤„ç†å„ç§è¾¹ç•Œæƒ…å†µï¼Œè¿˜è¦æ”¯æŒloaderå’Œpluginï¼Œç¾äººè¿˜æ˜¯æœ‰ç‚¹ä¸œè¥¿çš„ğŸ˜ã€‚</p>
<h2 id="èŠèŠæ¨¡å—çƒ­æ›¿æ¢">èŠèŠæ¨¡å—çƒ­æ›¿æ¢</h2>
<p>ä¹‹æ‰€ä»¥åœ¨è¿™é‡Œå•ç‹¬åˆ—å‡ºäº†æ¨¡å—çƒ­æ›¿æ¢ï¼ˆHMRï¼‰ï¼Œæ˜¯å› ä¸ºä¸€ç›´è§‰å¾—è¿™æ˜¯ä¸€ä¸ªå¾ˆé…·çš„åŠŸèƒ½ï¼ŒçŠ¹å¦‚é»‘é­”æ³•ä¸€èˆ¬çš„å­˜åœ¨ã€‚</p>
<h3 id="ä¼˜åŠ¿ä½•åœ¨">ä¼˜åŠ¿ä½•åœ¨</h3>
<p>æ¨¡å—çƒ­æ›¿æ¢ç®€ç§°ä¸º HMR(Hot Module Replacement)ï¼Œèƒ½å¤§å¤§æå‡å¼€å‘ä½“éªŒï¼Œæ˜¯éå¸¸å®ç”¨çš„ä¸€ä¸ªåŠŸèƒ½ã€‚åœ¨è¿™ä¹‹å‰ï¼Œç”¨å¾—æ¯”è¾ƒå¤šçš„æ˜¯<code>live-reload</code>ï¼Œåœ¨ç¼–è¾‘å™¨å’Œæµè§ˆå™¨å®‰è£…å¯¹åº”çš„æ’ä»¶åï¼Œå½“ç¼–è¾‘å™¨ä¿å­˜çš„æ—¶å€™ï¼Œæµè§ˆå™¨ä¼šè¿›è¡Œé¡µé¢åˆ·æ–°ï¼Œå…¶å®ç›¸æ¯”æ‰‹åŠ¨F5ä¹Ÿç®—æ¯”è¾ƒæ–¹ä¾¿äº†ã€‚ä¸è¿‡å®ƒåªèƒ½é‡‡ç”¨æ•´é¡µåˆ·æ–°ï¼Œæ‰€ä»¥å­˜åœ¨ä¸€äº›ç¼ºé™·ï¼š</p>
<ul>
<li>æ•ˆç‡ä½ï¼Œæ•´é¡µåˆ·æ–°æ„å‘³ç€æ‰€æœ‰èµ„æºå°†é‡æ–°åŠ è½½ï¼Œé€Ÿåº¦å¯æƒ³è€ŒçŸ¥ã€‚</li>
<li>å¦‚æœé¡µé¢ä¸­çš„çŠ¶æ€æœªé‡‡ç”¨æŒä¹…åŒ–ï¼Œåˆ·æ–°åçŠ¶æ€å°†ä¼šé‡ç½®ä¸¢å¤±ã€‚</li>
</ul>
<p>åœ¨gulpæµè¡Œçš„æ—¶å€™ï¼Œç”¨å¾—æ¯”è¾ƒå¤šçš„æ˜¯ä¸€ä¸ªå«<a href="https://browsersync.io/"><code>BrowserSync</code></a>çš„æ’ä»¶ï¼Œå¯ä»¥åŒæ—¶åœ¨å¤šä¸ªè®¾å¤‡æ‰“å¼€å¤šä¸ªæµè§ˆå™¨ï¼Œç‚¹å‡»å’Œæ»šåŠ¨æ“ä½œåœ¨æ‰€æœ‰æµè§ˆå™¨ä¸Šéƒ½ä¼šåŒæ­¥ï¼Œä¹Ÿç®—æ˜¯æ¯”è¾ƒå¥½ç”¨çš„ä¸€ä¸ªå·¥å…·ã€‚è¿™é‡Œå®ƒä¸æ˜¯ä¸»è§’ï¼Œä¸åšä»‹ç»ã€‚</p>
<p>webpackçš„HMRæ˜¯åœ¨åº”ç”¨è¿è¡Œæ—¶ï¼Œå°½é‡åœ¨é‡è½½æ•´ä¸ªé¡µé¢çš„å‰æä¸‹åŠ¨æ€æ›¿æ¢ã€æ·»åŠ æˆ–åˆ é™¤æ¨¡å—ï¼Œç›¸æ¯”ä»¥å¾€çš„å·¥å…·ï¼Œå®ƒæœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š</p>
<ul>
<li>æ›´æ–°é¡µé¢å†…å®¹çš„æ—¶å€™ä¸ä¼šä¸¢å¤±åº”ç”¨çš„çŠ¶æ€ï¼ˆä¸æ˜¯ç»å¯¹çš„ï¼Œå–å†³äºæ¨¡å—çš„å½±å“èŒƒå›´ï¼‰ã€‚</li>
<li>åªæ›´æ–°æœ‰å˜æ›´çš„å†…å®¹ï¼Œè€Œä¸æ˜¯æ•´é¡µé‡è½½ï¼Œå¿«é€Ÿå’Œé«˜æ•ˆã€‚</li>
</ul>
<h3 id="è¿è¡ŒåŸç†">è¿è¡ŒåŸç†</h3>
<p>å‰é¢å·²ç»ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨æ¨¡å—çƒ­æ›¿æ¢ï¼Œæ‰€ä»¥è¿™é‡Œä¸ä¼šå†èµ˜è¿°ç”¨æ³•ï¼Œä»…ä»…ç®€å•äº†è§£ä¸€ä¸‹ç›¸å…³æ¦‚å¿µå³å¯ã€‚</p>
<h4 id="manifest"><code>Manifest</code></h4>
<p>é¦–å…ˆéœ€è¦äº†è§£ä¸€ä¸‹<code>Manifest</code>ï¼Œå®ƒæ˜¯webpackç»´æŠ¤çš„ä¸€ä»½ç”¨äºç®¡ç†æ„å»ºè¿‡ç¨‹ä¸­æ‰€æœ‰æ¨¡å—åŠå…³è”å…³ç³»çš„æ•°æ®è¡¨ï¼ŒåŒ…å«äº†å„ä¸ªæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€æ¨¡å—å†…å®¹ç­‰è¯¦ç»†ä¿¡æ¯ï¼Œæ˜¯webpackè§£æå’ŒåŠ è½½æ¨¡å—çš„é‡è¦ä¾æ®ã€‚</p>
<h4 id="æ›´æ–°æµç¨‹">æ›´æ–°æµç¨‹</h4>
<figure data-type="image" tabindex="15"><img src="https://gitee.com/letwrong/Picture/raw/master/20200705205925.jpg" alt="img" loading="lazy"></figure>
<p>ä¸Šå›¾æ˜¯webpack é…åˆ webpack-dev-server è¿›è¡Œåº”ç”¨å¼€å‘çš„æ¨¡å—çƒ­æ›´æ–°æµç¨‹å›¾ï¼Œè®°å½•äº†å®Œæ•´çš„æ›´æ–°æµç¨‹ã€‚</p>
<ul>
<li>ä¸Šå›¾åº•éƒ¨çº¢è‰²æ¡†å†…æ˜¯æœåŠ¡ç«¯ï¼Œè€Œä¸Šé¢çš„æ©™è‰²æ¡†æ˜¯æµè§ˆå™¨ç«¯ã€‚</li>
<li>ç»¿è‰²çš„æ–¹æ¡†æ˜¯ webpack ä»£ç æ§åˆ¶çš„åŒºåŸŸã€‚è“è‰²æ–¹æ¡†æ˜¯ webpack-dev-server ä»£ç æ§åˆ¶çš„åŒºåŸŸï¼Œæ´‹çº¢è‰²çš„æ–¹æ¡†æ˜¯æ–‡ä»¶ç³»ç»Ÿï¼Œæ–‡ä»¶ä¿®æ”¹åçš„å˜åŒ–å°±å‘ç”Ÿåœ¨è¿™ï¼Œè€Œé’è‰²çš„æ–¹æ¡†æ˜¯åº”ç”¨æœ¬èº«ã€‚</li>
</ul>
<p>ä¸Šå›¾æ˜¾ç¤ºäº†ä¿®æ”¹ä»£ç åˆ°æ¨¡å—çƒ­æ›´æ–°å®Œæˆçš„ä¸€ä¸ªå‘¨æœŸï¼ˆæ­¥éª¤å·²ä½¿ç”¨åºå·æ ‡å‡ºï¼‰ï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>webpack å¯¹æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œ watch æ‰“åŒ…åˆ°å†…å­˜ä¸­ã€‚åœ¨ webpack çš„ watch æ¨¡å¼ä¸‹ï¼Œæ–‡ä»¶ç³»ç»Ÿä¸­æŸä¸€ä¸ªæ–‡ä»¶å‘ç”Ÿä¿®æ”¹ï¼Œwebpack ç›‘å¬åˆ°æ–‡ä»¶å˜åŒ–ï¼Œæ ¹æ®é…ç½®æ–‡ä»¶å¯¹æ¨¡å—é‡æ–°ç¼–è¯‘æ‰“åŒ…ï¼Œå¹¶å°†æ‰“åŒ…åçš„ä»£ç é€šè¿‡ç®€å•çš„ JavaScript å¯¹è±¡ä¿å­˜åœ¨å†…å­˜ä¸­ï¼ˆ<em>æ–‡ä»¶å†™åœ¨å†…å­˜ä¸­ï¼Œé€Ÿåº¦æ›´å¿«ï¼Œæ€§èƒ½æ›´é«˜ï¼Œä½¿ç”¨<a href="https://link.zhihu.com/?target=https%3A//github.com/webpack/memory-fs">memory-fs</a>å·¥å…·å®Œæˆ</em>ï¼‰ã€‚</li>
<li>webpack-dev-server å’Œ webpack ä¹‹é—´çš„æ¥å£äº¤äº’ã€‚è€Œåœ¨è¿™ä¸€æ­¥ï¼Œä¸»è¦æ˜¯ dev-server çš„ä¸­é—´ä»¶ webpack-dev-middleware å’Œ webpack ä¹‹é—´çš„äº¤äº’ï¼Œwebpack-dev-middleware è°ƒç”¨ webpack æš´éœ²çš„ APIå¯¹ä»£ç å˜åŒ–è¿›è¡Œç›‘æ§ï¼Œå¹¶ä¸”å‘Šè¯‰ webpackï¼Œå°†ä»£ç æ‰“åŒ…åˆ°å†…å­˜ä¸­ã€‚</li>
<li>webpack-dev-server å¯¹æ–‡ä»¶å˜åŒ–çš„ä¸€ä¸ªç›‘æ§ã€‚è¿™ä¸€æ­¥ä¸åŒäºç¬¬ä¸€æ­¥ï¼Œå¹¶ä¸æ˜¯ç›‘æ§ä»£ç å˜åŒ–é‡æ–°æ‰“åŒ…ã€‚å½“æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®äº†<a href="https://link.zhihu.com/?target=https%3A//webpack.js.org/configuration/dev-server/%23devserver-watchcontentbase">devServer.watchContentBase</a> ä¸º true çš„æ—¶å€™ï¼ŒServer ä¼šç›‘å¬è¿™äº›é…ç½®æ–‡ä»¶å¤¹ä¸­é™æ€æ–‡ä»¶çš„å˜åŒ–ï¼Œå˜åŒ–åä¼šé€šçŸ¥æµè§ˆå™¨ç«¯å¯¹åº”ç”¨è¿›è¡Œ live reloadã€‚æ³¨æ„ï¼Œè¿™å„¿æ˜¯æµè§ˆå™¨åˆ·æ–°ï¼Œå’Œ HMR æ˜¯ä¸¤ä¸ªæ¦‚å¿µã€‚</li>
<li>webpack-dev-server ä»£ç çš„å·¥ä½œã€‚è¯¥æ­¥éª¤ä¸»è¦æ˜¯é€šè¿‡ <a href="https://link.zhihu.com/?target=https%3A//github.com/sockjs/sockjs-client">sockjs</a>ï¼ˆwebpack-dev-server çš„ä¾èµ–ï¼‰åœ¨æµè§ˆå™¨ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´å»ºç«‹ä¸€ä¸ª websocket é•¿è¿æ¥ï¼Œå°† webpack ç¼–è¯‘æ‰“åŒ…çš„å„ä¸ªé˜¶æ®µçš„çŠ¶æ€ä¿¡æ¯å‘ŠçŸ¥æµè§ˆå™¨ç«¯ï¼ŒåŒæ—¶ä¹ŸåŒ…æ‹¬ç¬¬ä¸‰æ­¥ä¸­ Server ç›‘å¬é™æ€æ–‡ä»¶å˜åŒ–çš„ä¿¡æ¯ã€‚æµè§ˆå™¨ç«¯æ ¹æ®è¿™äº› socket æ¶ˆæ¯è¿›è¡Œä¸åŒçš„æ“ä½œã€‚å½“ç„¶æœåŠ¡ç«¯ä¼ é€’çš„æœ€ä¸»è¦ä¿¡æ¯è¿˜æ˜¯æ–°æ¨¡å—çš„ hash å€¼ï¼Œåé¢çš„æ­¥éª¤æ ¹æ®è¿™ä¸€ hash å€¼æ¥è¿›è¡Œæ¨¡å—çƒ­æ›¿æ¢ã€‚</li>
<li>webpack-dev-server/client ç«¯å¹¶ä¸èƒ½å¤Ÿè¯·æ±‚æ›´æ–°çš„ä»£ç ï¼Œä¹Ÿä¸ä¼šæ‰§è¡Œçƒ­æ›´æ¨¡å—æ“ä½œï¼Œè€ŒæŠŠè¿™äº›å·¥ä½œåˆäº¤å›ç»™äº† webpackï¼Œwebpack/hot/dev-server çš„å·¥ä½œå°±æ˜¯æ ¹æ® webpack-dev-server/client ä¼ ç»™å®ƒçš„ä¿¡æ¯ä»¥åŠ dev-server çš„é…ç½®å†³å®šæ˜¯åˆ·æ–°æµè§ˆå™¨å‘¢è¿˜æ˜¯è¿›è¡Œæ¨¡å—çƒ­æ›´æ–°ã€‚å½“ç„¶å¦‚æœä»…ä»…æ˜¯åˆ·æ–°æµè§ˆå™¨ï¼Œä¹Ÿå°±æ²¡æœ‰åé¢é‚£äº›æ­¥éª¤äº†ã€‚</li>
<li>HotModuleReplacement.runtime æ˜¯å®¢æˆ·ç«¯ HMR çš„ä¸­æ¢ï¼Œå®ƒæ¥æ”¶åˆ°ä¸Šä¸€æ­¥ä¼ é€’ç»™ä»–çš„æ–°æ¨¡å—çš„ hash å€¼ï¼Œå®ƒé€šè¿‡ JsonpMainTemplate.runtime å‘ server ç«¯å‘é€ Ajax è¯·æ±‚ï¼ŒæœåŠ¡ç«¯è¿”å›ä¸€ä¸ª jsonï¼Œè¯¥ json åŒ…å«äº†æ‰€æœ‰è¦æ›´æ–°çš„æ¨¡å—çš„ hash å€¼ï¼Œè·å–åˆ°æ›´æ–°åˆ—è¡¨åï¼Œè¯¥æ¨¡å—å†æ¬¡é€šè¿‡ jsonp è¯·æ±‚ï¼Œè·å–åˆ°æœ€æ–°çš„æ¨¡å—ä»£ç ã€‚è¿™å°±æ˜¯ä¸Šå›¾ä¸­ 7ã€8ã€9 æ­¥éª¤ã€‚</li>
<li>è€Œç¬¬ 10 æ­¥æ˜¯å†³å®š HMR æˆåŠŸä¸å¦çš„å…³é”®æ­¥éª¤ï¼Œåœ¨è¯¥æ­¥éª¤ä¸­ï¼ŒHotModulePlugin å°†ä¼šå¯¹æ–°æ—§æ¨¡å—è¿›è¡Œå¯¹æ¯”ï¼Œå†³å®šæ˜¯å¦æ›´æ–°æ¨¡å—ï¼Œåœ¨å†³å®šæ›´æ–°æ¨¡å—åï¼Œæ£€æŸ¥æ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œæ›´æ–°æ¨¡å—çš„åŒæ—¶æ›´æ–°æ¨¡å—é—´çš„ä¾èµ–å¼•ç”¨ã€‚</li>
<li>æœ€åä¸€æ­¥ï¼Œå½“ HMR å¤±è´¥åï¼Œå›é€€åˆ° live reload æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¿›è¡Œæµè§ˆå™¨åˆ·æ–°æ¥è·å–æœ€æ–°æ‰“åŒ…ä»£ç ã€‚</li>
</ol>
<p>å¦‚ä¸Šå°±æ˜¯çƒ­æ›´æ–°çš„è¿‡ç¨‹ï¼Œå½“ç„¶è¿™åªæ˜¯webpackæ‰€åšçš„å·¥ä½œï¼Œæ­¤æ—¶ä¸šåŠ¡ä»£ç ä¸­å¹¶ä¸èƒ½çŸ¥é“ä»£ç æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œæˆ‘ä»¬å¿…é¡»ä½¿ç”¨å‰é¢æåˆ°çš„<code>accept</code>æ–¹æ³•æ¥è¿›è¡Œç›‘å¬ï¼Œå¹¶å®ç°å¯¹åº”çš„å˜åŒ–ç›¸åº”æ“ä½œã€‚</p>
<pre><code class="language-js">if(module.hot) { // å…ˆåˆ¤æ–­æ˜¯å¦å¼€å¯HMR
    module.hot.accept('./xxx.js', function() {
        // do something
    })
}
</code></pre>
<p><strong>æç¤ºï¼š<code>accept</code>æ–¹æ³•å†…å®¹ä¸€èˆ¬ä¸ç”¨è‡ªå·±å®ç°ï¼Œå¾ˆå¤šå·¥å…·ï¼ˆå¦‚vue-loaderï¼Œstyle-loaderï¼‰å†…éƒ¨å·²æä¾›ï¼Œç›´æ¥ä½¿ç”¨å³å¯ã€‚</strong></p>
<p>å‚è€ƒèµ„æ–™ï¼š<a href="https://zhuanlan.zhihu.com/p/30669007">Webpack HMR åŸç†è§£æ</a>ï¼Œ<a href="https://juejin.im/post/6844904193136787470">äº†ä¸èµ·çš„ Webpack HMR å­¦ä¹ æŒ‡å—</a>ã€‚</p>
<h2 id="å¼€å‘loader">å¼€å‘loader</h2>
<p>webpackå®˜æ–¹å’Œç¤¾åŒºå·²ç»æä¾›äº†éå¸¸å¤šçš„loaderï¼Œæ­£å¸¸æ¥è¯´ï¼Œå¸¸ç”¨çš„æ–‡ä»¶è§£æéƒ½å¯ä»¥æ‰¾åˆ°ç°æˆçš„loaderã€‚ä¸è¿‡ï¼Œæ¥äº†è§£ä¸€ä¸‹å¦‚ä½•å¼€å‘loaderï¼Œæœ‰åŠ©äºè‡ªå·±å¯¹loaderå·¥ä½œåŸç†çš„ç†è§£ï¼Œè€Œä¸”åœ¨æœ‰éœ€æ±‚çš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥è‡ªå·±æ’¸ä¸€ä¸ªloaderã€‚</p>
<h3 id="å¼€å‘ä¸€ä¸ªç®€å•çš„loader">å¼€å‘ä¸€ä¸ªç®€å•çš„loader</h3>
<p>å…¶å®è‡ªå®šä¹‰ä¸€ä¸ªloaderéå¸¸ç®€å•ï¼Œæœ¬è´¨ä¸Šloaderå³æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ¥æ”¶å‚æ•°å¹¶å¯¹å…¶è¿›è¡Œå¤„ç†ï¼Œè€Œåè¿”å›å¤„ç†ç»“æœï¼ˆ<strong>é¡»ä¸ºbufferæˆ–string</strong>ï¼‰ã€‚</p>
<ul>
<li>æ–°å»º<code>/loaders/replaceLoader.js</code>ï¼Œ</li>
</ul>
<pre><code class="language-js">// /loaders/replaceLoader.js
module.exports = function (source) {
  source = source.replace(/webpack/gi, 'world'); // å°†æºæ–‡ä»¶ä¸­çš„webpackæ›¿æ¢æˆworld
  return source;
};
</code></pre>
<ul>
<li>æ–°å»º<code>/src/index.js</code></li>
</ul>
<pre><code class="language-js">// /src/index.js
console.log('hello webpack');
</code></pre>
<ul>
<li>é…ç½®webpack</li>
</ul>
<p>æ¥ä¸‹æ¥ï¼Œæœ‰å¿…è¦å…ˆäº†è§£ä¸‹å¦‚ä½•æ¥é…ç½®ä¸Šé¢çš„loaderã€‚ä¸€èˆ¬ç¬¬ä¸‰æ–¹çš„loaderï¼Œå®‰è£…äº†éƒ½åœ¨<code>node_modules</code>ä¸‹é¢ï¼Œwebpackä¼šä»æ­¤å¤„å»æ‰¾ï¼Œä½†æ˜¯ç°åœ¨loaderåœ¨<code>/loaders/testLoader.js</code>ï¼Œæ‰€ä»¥éœ€è¦åšäº›å¤„ç†ï¼Œæœ‰å¦‚ä¸‹å‡ ç§æ–¹å¼ï¼š</p>
<ol>
<li>ç›´æ¥requireå¯¹åº”çš„loaderï¼ˆé€‚ç”¨äºå•ä¸ªloaderï¼‰</li>
</ol>
<pre><code class="language-js">// webpack.config.js
module: {
  rules: [
    {
      test: /\.js$/,
      exclude: /node_modules/,
      loader: path.resolve('./loaders/replaceLoader.js')
    }
  ]
}
</code></pre>
<ol start="2">
<li>ä½¿ç”¨<code>resolveLoader</code>é…ç½®é¡¹ï¼ˆé€‚ç”¨äºå¤šä¸ªloaderï¼‰</li>
</ol>
<pre><code class="language-js">// webpack.config.js
module: {
  rules: [
    {
      test: /\.js$/,
      exclude: /node_modules/,
      use:'replaceLoader'
    }
  ]
},
resolveLoader: {
  modules: ['node_modules', path.resolver(__dirname, 'loaders')] // æŸ¥æ‰¾ä¼˜å…ˆçº§ä»å·¦åˆ°å³
}
</code></pre>
<ol start="3">
<li>å¦‚æœå‡†å¤‡å°†loaderå‘å¸ƒåˆ°npmï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <a href="https://docs.npmjs.com/cli/link">npm-link</a>ã€‚</li>
</ol>
<p>è¿™é‡Œï¼Œé‡‡ç”¨ç¬¬äºŒç§æ–¹å¼ï¼Œå®Œæ•´é…ç½®å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">// webpack.config.js
const path = require('path');
module.exports = {
  mode:'development',
  entry: './src/index.js',
  output: {
    filename: 'bundle.js',
    path: path.resolve(__dirname, 'dist')
  },
  resolveLoader: {
    modules: ['node_modules', path.resolve(__dirname, 'loaders')]
  },
  module: {
    rules: [{
      test: /\.js$/,
      use:'replaceLoader'
    }]
  }
};
</code></pre>
<p>è¿è¡Œä¸€ä¸‹ï¼Œæ‰“åŒ…å‘½ä»¤<code>npx webpack</code>ï¼Œå¯ä»¥çœ‹åˆ°è¾“å‡ºæ–‡ä»¶ä¸­çš„webpackè¢«æ›¿æ¢æˆäº†worldã€‚</p>
<figure data-type="image" tabindex="16"><img src="https://gitee.com/letwrong/Picture/raw/master/20200614224707.png" alt="image-20200614224707431" loading="lazy"></figure>
<p>ä¸€èˆ¬loaderéƒ½ä¼šæä¾›é…ç½®é¡¹(options)ï¼Œæ–¹ä¾¿ç”¨æˆ·åšä¸ªæ€§é…ç½®ï¼Œå¯ä»¥é€šè¿‡<code>this.query</code>è·å–é…ç½®å†…å®¹ï¼Œä¸è¿‡ä¸€èˆ¬ä½¿ç”¨å®˜æ–¹æ¨èçš„<a href="https://github.com/webpack/loader-utils">loader-utils</a> å·¥å…·æ›´åŠ ä¾¿æ·ã€‚</p>
<pre><code class="language-js">// webpack.config.js
const path = require('path');
module.exports = {
  mode:'development',
  entry: './src/index.js',
  output: {
    filename: 'bundle.js',
    path: path.resolve(__dirname, 'dist')
  },
  resolveLoader: {
    modules: ['node_modules', path.resolve(__dirname, 'loaders')]
  },
  module: {
    rules: [{
      test: /\.js$/,
      use: {
        loader:'replaceLoader',
        options: {
          src: /webpack/ig, // é…ç½®è¦æ›¿æ¢çš„å†…å®¹
          to: 'world!' // é…ç½®æ›¿æ¢çš„ç›®æ ‡å†…å®¹
        }
      }
    }]
  }
};
</code></pre>
<p>ä¿®æ”¹ä¸€ä¸‹<code>replaceLoader</code>ï¼š</p>
<pre><code class="language-js">// /loaders/replaceLoader.js
const loaderUtils = require('loader-utils');
module.exports = function (source) {
  const options = loaderUtils.getOptions(this);
  source = source.replace(options.src, options.to);
  return source;
};
</code></pre>
<p>**æ³¨æ„ï¼š**è¿™é‡Œä½¿ç”¨äº†thisï¼Œthisæä¾›äº†å¾ˆå¤šæœ‰ç”¨çš„ä¿¡æ¯ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼ˆä¼šæ”¹å˜thisæŒ‡å‘ï¼‰ã€‚å¦‚æœéœ€è¦å¯¹optionsè¿›è¡Œæ ¡éªŒï¼Œå¯ä»¥ä½¿ç”¨<a href="https://github.com/webpack/schema-utils">schema-utils</a>ã€‚</p>
<h3 id="å¤æ‚çš„æƒ…å†µ">å¤æ‚çš„æƒ…å†µ</h3>
<p>è‡³æ­¤ï¼Œä¸€ä¸ªç®€å•çš„loaderå°±å®ç°äº†ï¼Œå½“ç„¶æœ‰æ—¶å€™å¯èƒ½ä¼šæ›´åŠ å¤æ‚ã€‚</p>
<p>å…¶å®ï¼Œloaderå‡½æ•°ä¼šæ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼šcontentã€mapã€meta</p>
<ul>
<li>contentï¼šæ¨¡å—å†…å®¹ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–è€…buffer</li>
<li>mapï¼šsourcemap å¯¹è±¡</li>
<li>metaï¼šä¸€äº›å…ƒæ•°æ®ä¿¡æ¯</li>
</ul>
<p>å¦‚æœä»…ä»…æ˜¯è¿”å›å¤„ç†ç»“æœï¼Œç›´æ¥è¿”å›contentå³å¯ã€‚ä½†å¦‚æœéœ€è¦ç”Ÿæˆsourcemap å¯¹è±¡ã€metaå…ƒæ•°æ®æˆ–è€…æŠ›å‡ºå¼‚å¸¸ï¼Œéœ€è¦å°†returnæ¢æˆ<code>this.callback(err, content, map, meta)</code>æ¥ä¼ é€’æ•°æ®ã€‚</p>
<pre><code class="language-js">this.callback(
    // å½“æ— æ³•è½¬æ¢åŸå†…å®¹æ—¶ï¼Œç»™ Webpack è¿”å›ä¸€ä¸ª Error
    err: Error | null,
    // åŸå†…å®¹è½¬æ¢åçš„å†…å®¹
    content: string | Buffer,
    // ç”¨äºæŠŠè½¬æ¢åçš„å†…å®¹å¾—å‡ºåŸå†…å®¹çš„ Source Mapï¼Œæ–¹ä¾¿è°ƒè¯•
    sourceMap?: SourceMap,
    // å¦‚æœæœ¬æ¬¡è½¬æ¢ä¸ºåŸå†…å®¹ç”Ÿæˆäº† AST è¯­æ³•æ ‘ï¼Œå¯ä»¥æŠŠè¿™ä¸ª AST è¿”å›ï¼Œ
    // ä»¥æ–¹ä¾¿ä¹‹åéœ€è¦ AST çš„ Loader å¤ç”¨è¯¥ ASTï¼Œä»¥é¿å…é‡å¤ç”Ÿæˆ ASTï¼Œæå‡æ€§èƒ½
    abstractSyntaxTree?: AST
);
</code></pre>
<p>å¦å¤–ï¼Œloaderä¹Ÿæ˜¯æ”¯æŒå¼‚æ­¥ä»»åŠ¡å¤„ç†çš„ï¼Œå¯ä»¥å€ŸåŠ©<code>this.async()</code>å®ç°ã€‚</p>
<pre><code class="language-js">// /loaders/replaceLoader.js
const loaderUtils = require('loader-utils');
module.exports = function (source) {
  const options = loaderUtils.getOptions(this);
  const asyncfunc = this.async() // è°ƒç”¨å¼‚æ­¥func
  setTimeout(() =&gt; {
  	source = source.replace(options.src, options.to);
    asyncfunc(null, source) // ä¼ é€’ç»“æœ
  }, 200)
};
</code></pre>
<p>å…³äºloaderçš„å¼€å‘ï¼Œå®˜æ–¹æä¾›äº†å¾ˆå¤šapiï¼Œè¯»è€…å¯ä»¥æŸ¥é˜… <a href="https://webpack.js.org/api/loaders/">loader interface</a> äº†è§£ã€‚</p>
<h3 id="æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹</h3>
<ul>
<li>loaderè¦éµå¾ªèŒè´£å•ä¸€åŸåˆ™ï¼Œä¸€ä¸ªloaderåªåšä¸€ç§è½¬æ¢ï¼Œå¦‚æœéœ€è¦å¯¹æºæ–‡ä»¶è¿›è¡Œå¤šæ¬¡è½¬æ¢å¤„ç†ï¼Œåˆ™éœ€è¦å¤šä¸ªloaderæ¥å®ç°ã€‚</li>
<li>è°ƒç”¨å¤šä¸ªloaderæ¥å¤„ç†ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹loaderä¼šä»ååˆ°å‰é“¾å¼é¡ºåºæ‰§è¡Œï¼Œæœ€åä¸€ä¸ªloaderå°†ä¼šæ‹¿åˆ°æ–‡ä»¶çš„åŸå§‹å†…å®¹ï¼Œå¤„ç†åä¼šå°†ç»“æœä¼ é€’ç»™ä¸‹ä¸€ä¸ªloaderç»§ç»­å¤„ç†ï¼Œç›´åˆ°æœ€å‰é¢çš„loaderå¤„ç†å®Œæˆè¿”å›ç»™webpackã€‚</li>
</ul>
<h2 id="å¼€å‘plugin">å¼€å‘plugin</h2>
<p>pluginæ˜¯webpackä¸­éå¸¸é‡è¦çš„éƒ¨åˆ†ï¼Œå®ƒèµ‹äºˆäº†webpackå¼ºå¤§çš„æ‰©å±•èƒ½åŠ›ã€‚å’Œloaderä¸åŒçš„æ˜¯loaderä¸»è¦æ˜¯ä¸ºäº†è®©webpackèƒ½å¤Ÿè§£ææ›´å¤šç±»å‹çš„æ–‡ä»¶ï¼Œè€Œpluginåˆ™å¯ä»¥å‚ä¸æ‰“åŒ…è¿‡ç¨‹ä¸­æ¯ä¸ªé˜¶æ®µã€‚ä»ä½¿ç”¨æ–¹å¼æˆ‘ä»¬å¯ä»¥çœ‹å‡ºpluginå…¶å®å°±æ˜¯ä¸€ä¸ªç±»ï¼Œåœ¨è°ƒç”¨æ„é€ å‡½æ•°çš„æ—¶å€™ä¼ å…¥é…ç½®å‚æ•°ã€‚</p>
<p>**æ³¨æ„ï¼š**ä¸‹é¢ä½¿ç”¨çš„æ˜¯webpack4.0ç‰ˆæœ¬ï¼Œç›¸æ¯”3.0çš„apiæ˜¯ä¸ä¸€æ ·çš„ã€‚</p>
<h3 id="å¼€å‘ä¸€ä¸ªç®€å•çš„plugin">å¼€å‘ä¸€ä¸ªç®€å•çš„plugin</h3>
<p>è‡ªå®šä¹‰pluginçš„å¼•å…¥æ–¹å¼ç›¸æ¯”loaderæ¥è¯´ï¼Œéå¸¸ç®€å•ï¼š</p>
<pre><code class="language-js">// webpack.config.js
const path = require('path')
const TestWebpackPlugin = require('./test-webpack-plugin')
module.exports = {
    mode: 'development',
    entry: './src/index.js',
    output: {
        path: path.resolve(__dirname, 'dist'),
        filename: '[name]_[hash].js'
    },
    plugins: [
        new TestWebpackPlugin({
            // ...options
        })
    ]
}
</code></pre>
<blockquote>
<p>webpackçš„pluginå‘½åéœ€è¦éµå¾ª<code>æ’ä»¶åå­—-webpack-plugin</code>çš„æ ¼å¼ã€‚</p>
</blockquote>
<p>è€Œpluginå†…éƒ¨çš„å®ç°ä¹Ÿæ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œç”±ä»¥ä¸‹å‡ éƒ¨åˆ†ç»„æˆï¼š</p>
<ul>
<li>ä¸€ä¸ªå¯ä»¥é€šè¿‡newè°ƒç”¨çš„ç±»å‡½æ•°</li>
<li>åœ¨è¯¥å‡½æ•°çš„<code>prototype</code>ä¸Šå®šä¹‰ä¸€ä¸ª<code>apply</code>æ–¹æ³•ï¼Œå‚æ•°ä¸º<code>compiler</code></li>
<li>åœ¨<code>apply</code>æ–¹æ³•ä¸­æ³¨å†Œè¦ç›‘å¬çš„é’©å­åç§°ã€æ’ä»¶åç§°ã€å›è°ƒå‡½æ•°</li>
<li>åœ¨å›è°ƒå‡½æ•°ä¸­é€šè¿‡æ³¨å…¥çš„å‚æ•°ï¼Œè¯»å–æˆ–æ“çºµä¿®æ”¹ Webpack å†…éƒ¨å®ä¾‹æ•°æ®</li>
<li>å¼‚æ­¥ç±»å‹çš„äº‹ä»¶é’©å­ï¼Œæ’ä»¶å¤„ç†å®Œæˆéœ€è¦è°ƒç”¨<code>callback</code>æˆ–è€…è¿”å›<code>promise</code></li>
</ul>
<pre><code class="language-js">// test-webpack-plugin.js
class TestWebpackPlugin {
    constructor (options) {
        // åœ¨è¿™é‡Œè·å–æ’ä»¶é…ç½®
    }
    // Webpack ä¼šè°ƒç”¨æ­¤ apply æ–¹æ³•å¹¶ä¼ å…¥ compiler å¯¹è±¡
    apply (compiler) {
     		 // è¿™é‡Œå¯ä»¥åœ¨compilerçš„é’©å­ï¼ˆhookï¼‰ä¸Šæ³¨å†Œä¸€äº›æ–¹æ³•ï¼Œ	å½“webpackæ‰§è¡Œåˆ°ç‰¹å®šçš„é’©å­æ—¶å°±ä¼šæ‰§è¡Œè¯¥é˜¶æ®µæ³¨å†Œçš„æ–¹æ³•
        compiler.hooks.done.tap('TestWebpackPlugin', (stats) =&gt; {
          console.log('Hello TestWebpackPlugin!');
            // ...
        })
      	// åœ¨emité’©å­ä¸Šæ³¨å†Œä¸€ä¸ªå¤„ç†å‡½æ•°ï¼Œå› ä¸ºè¯¥é’©å­ä¸ºå¼‚æ­¥çš„ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨tapAsync
      	// emité’©å­æ‰§è¡Œæ—¶æœºåœ¨èµ„æºè¾“å‡ºåˆ°outputä¹‹å‰
        compiler.hooks.emit.tapAsync('TestWebpackPlugin', (compilation, cb) =&gt; {
            // åœ¨è¾“å‡ºæ–‡ä»¶ä¸­å¢åŠ ä¸€ä¸ªæ–‡ä»¶test.js
            compilation.assets['test.js'] = {
              source() { // æ–‡ä»¶å†…å®¹
                return 'console.log(&quot;hello world&quot;)'
              },
              size() { // æ–‡ä»¶çš„é•¿åº¦
                return 27;
              }
            };
            cb();    // å¤„ç†å®Œæˆè°ƒç”¨cb
        })
    }
}
module.exports = TestWebpackPlugin
</code></pre>
<h3 id="æ‰§è¡Œæµç¨‹">æ‰§è¡Œæµç¨‹</h3>
<p>pluginå†…éƒ¨æ ¸å¿ƒå°±æ˜¯applyï¼Œä½¿ç”¨æ’ä»¶çš„æ—¶å€™ï¼Œwebpackä¼šè‡ªåŠ¨è°ƒç”¨æ’ä»¶å®ä¾‹çš„applyæ–¹æ³•ï¼Œå¹¶å°†compilerä½œä¸ºå‚æ•°ä¼ å…¥ã€‚åœ¨<code>apply</code>å†…éƒ¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨<code>compiler</code>çš„hooksä¸­ç‰¹å®šçš„é’©å­ä¸Šæ³¨å†Œå„ç§ç›‘å¬å‡½æ•°ï¼ˆå‘å¸ƒè®¢é˜…æ¨¡å¼ï¼‰ï¼Œå½“webpackæ‰§è¡Œåˆ°è¿™äº›é’©å­çš„æ—¶å€™ï¼Œå°±ä¼šè°ƒç”¨å¯¹åº”çš„ç›‘å¬å‡½æ•°ï¼Œä»è€Œå®ç°å¯¹æ„å»ºæµç¨‹çš„å¤„ç†ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬ä»¥å‰é¢ä¾‹å­æ¥äº†è§£æ’ä»¶å…·ä½“çš„æ‰§è¡Œæµç¨‹ï¼š</p>
<ul>
<li>
<p>é€šè¿‡<code>&lt;instance&gt;.hooks.&lt;hook name&gt;.&lt;tap API&gt;('&lt;plugin name&gt;', callback )</code>æ–¹å¼æ¥è¿›è¡Œhooksäº‹ä»¶æ³¨å†Œã€‚</p>
<ul>
<li><code>instance</code>ï¼š <code>compiler</code> æˆ– <code>compilation</code> å®ä¾‹</li>
<li><code>hook name</code> ï¼šæŒ‚è½½ç›®æ ‡é’©å­çš„åç§°</li>
<li>å¤„ç†é’©å­å¯èƒ½æ˜¯åŒæ­¥ï¼Œä¹Ÿå¯èƒ½æ˜¯å¼‚æ­¥çš„ï¼Œéœ€è¦ä½¿ç”¨æ ¹æ®ä¸åŒæƒ…å†µé€‰æ‹©ä½¿ç”¨çš„<code>tap API</code>ï¼Œ<code>tap API</code> æœ‰ä¸‰ç§ï¼š</li>
<li><code>tap</code> ç”¨äºæŒ‚è½½ä¸€ä¸ªåŒæ­¥å›è°ƒï¼Œé€‚åˆä»»ä½•äº‹ä»¶é’©å­ç±»å‹ï¼Œä½¿ç”¨å›è°ƒè¿”å›ç»“æœã€‚
<ul>
<li><code>tapAsync</code> ç”¨äºæŒ‚è½½ä¸€ä¸ªå¼‚æ­¥å›è°ƒï¼Œä¸èƒ½å¯¹åŒæ­¥ç±»å‹é’©å­ä½¿ç”¨ï¼Œå›è°ƒä¸­ä¼šæ³¨å…¥ <code>callback</code>å‚æ•°ä¾›æ’ä»¶å¤„ç†å®Œæ“ä½œåè°ƒç”¨ï¼Œå¦‚æœä¸è°ƒç”¨ <code>callback</code> äº¤å›æµç¨‹æ§åˆ¶æƒï¼Œå°†æ— æ³•ç»§ç»­è¿›è¡Œåç»­æ“ä½œã€‚</li>
<li><code>tapPromise</code> å’Œ <code>tapAsync</code> çš„ä½œç”¨å’Œé™åˆ¶ç±»ä¼¼ï¼Œä¸åŒåœ¨äºè¦æ±‚è¿”å›ä¸€ä¸ª <code>Promise</code> å®ä¾‹ï¼Œå¹¶ä¸”è¿™ä¸ª <code>Promise</code> ä¸€å®šä¼šè¢«å†³è®®ï¼ˆæ— è®º resolve æˆ– reject ï¼‰</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre><code class="language-js">// åŒæ­¥
compiler.hooks.done.tap('MyPlugin', (stats, callback) =&gt; {
  // ...
  callback()
})
// å¼‚æ­¥promise
compiler.hooks.emit.tapPromise('MyPlugin', (compilation) =&gt; {
  return new Promise((resolve, reject) =&gt; {
    // ...
  })
})
// å¼‚æ­¥async function
compiler.hooks.emit.tapPromise('MyPlugin', async (compilation) =&gt; {
  await new Promise((resolve, reject) =&gt; {
    // ...
  })
})
// å¼‚æ­¥å›è°ƒ
compiler.hooks.emit.tapAsync('MyPlugin', (compilation, callback) =&gt; {
	// ...
  callback()
})
</code></pre>
<ul>
<li>
<p>åœ¨é’©å­ä¸Šæ³¨å†Œçš„å‡½æ•°ï¼Œæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªä¸ºæ’ä»¶çš„åå­—ï¼Œç¬¬äºŒä¸ªä¸ºå›è°ƒå‡½æ•°</p>
<ul>
<li>è¿™ä¸ªå›è°ƒå‡½æ•°å³ä¸ºå¤„ç†å‡½æ•°çš„ä¸»è¦å†…å®¹ï¼Œæ¥æ”¶çš„å‚æ•°ç”±é’©å­å†³å®šï¼Œè¿™é‡Œçš„<code>emit</code>é’©å­æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼ˆåˆ†åˆ«æ˜¯compilation, cbï¼‰ï¼Œcompilationè®°å½•äº†æœ¬æ¬¡æ‰“åŒ…çš„ç›¸å…³å†…å®¹ï¼Œcbå›è°ƒå‡½æ•°åœ¨å¤„ç†å®Œæˆè¿›è¡Œè°ƒç”¨äº¤å›æ§åˆ¶æƒã€‚</li>
</ul>
</li>
<li>
<p><code>compilation.assets</code>ä¿å­˜äº†æœ¬æ¬¡æ‰“åŒ…å‡ºæ¥çš„æ‰€æœ‰çš„æ–‡ä»¶ä¿¡æ¯ï¼Œä¸Šé¢çš„ä¾‹å­å³å¾€<code>assets</code>ä¸­æ–°å¢äº†ä¸€ä¸ª<code>test.js</code>æ–‡ä»¶ï¼ˆå‰ææ˜¯æ·»åŠ ä¹‹å‰ï¼Œassetsä¸­æ²¡æœ‰ä¸è¯¥æ–‡ä»¶åŒåçš„æ–‡ä»¶ï¼‰ï¼Œsourceå’Œsizeåˆ†åˆ«è®¾ç½®äº†æ–‡ä»¶çš„å†…å®¹å’Œé•¿åº¦ã€‚å¦‚æœæ˜¯å¯¹æ–‡ä»¶è¿›è¡Œå¤„ç†ï¼Œç›´æ¥å¯¹<code>assets</code>ä¸­çš„æ–‡ä»¶è¿›è¡Œæ“ä½œå³å¯ã€‚</p>
</li>
<li>
<p>compilationä¸Šä¹Ÿå¯ä»¥æ³¨å†Œé’©å­, å³å­˜åœ¨<a href="https://webpack.js.org/api/compiler-hooks/">Compiler Hooks</a>å’Œ<a href="https://webpack.js.org/api/compilation-hooks/">Compilation Hooks</a>ä¸¤ç§ã€‚</p>
</li>
</ul>
<pre><code class="language-js">compiler.hooks.compilation.tap('MyPlugin', (compilation) =&gt; {
  compilation.hooks.optimizeChunkAssets.tapAsync(
      'MyPlugin',
      (chunks, callback) =&gt; {
       	// å¤„ç†chunks
        // ç»“æŸè°ƒç”¨callbackæ–¹æ³•
        callback();
      }
    );
})
</code></pre>
<h3 id="hooks">hooks</h3>
<p>é™¤äº†ä¸Šè¿°çš„<code>emit</code>é’©å­ï¼Œwebpackè¿˜æä¾›äº†è®¸å¤šå…¶ä»–çš„é’©å­ï¼Œè¦†ç›–åˆ°æ‰“åŒ…çš„å„ä¸ªé˜¶æ®µã€‚</p>
<h4 id="entryoption"><code>entryOption</code></h4>
<p>åœ¨<code>entry</code>é…ç½®é¡¹å¤„ç†å®Œæˆåæ‰§è¡Œï¼ŒåŒæ­¥é’©å­ã€‚</p>
<pre><code class="language-js">compiler.hooks.entryOption.tap('MyPlugin', (context, entry) =&gt; {
  // contextä¿å­˜äº†å½“å‰ç›®å½•ä¿¡æ¯ï¼Œentryä¿å­˜äº†å…¥å£æ–‡ä»¶ä¿¡æ¯
});
</code></pre>
<h4 id="afteremit"><code>afterEmit</code></h4>
<p>ç”Ÿæˆèµ„æºåˆ°<code>output</code>åæ‰§è¡Œï¼Œå¼‚æ­¥é’©å­ã€‚</p>
<h4 id="done"><code>done</code></h4>
<p>ç¼–è¯‘å®Œæˆæ‰§è¡Œï¼ŒåŒæ­¥é’©å­ã€‚</p>
<pre><code class="language-js">compiler.hooks.done.tap('TestWebpackPlugin', (stats) =&gt; {
  // statsä¿å­˜äº†ç”Ÿæˆæ–‡ä»¶çš„å†…å®¹
})
</code></pre>
<p>æ›´å¤šçš„hookså’Œç”¨æ³•å¯ä»¥æŸ¥çœ‹<a href="https://webpack.js.org/api/compiler-hooks/#hooks">Plugin-Compiler Hooks</a>ã€‚</p>
<p>è¿™äº›hooksçš„å®ç°æ˜¯åŸºäº<a href="https://github.com/webpack/tapable/">tapable</a>è¿™ä¸ªåº“ï¼Œè¿™ä¸ªåº“æä¾›äº†å¤§é‡çš„é’©å­ã€‚è¿™äº›é’©å­å¤§æ¦‚åˆ†ä¸ºå¦‚ä¸‹å‡ ç±»ï¼š</p>
<ul>
<li>å¹¶è¡Œçš„ï¼šåç§°å¸¦æœ‰<code>parallel</code>ï¼Œè¯¥ç±»å‡½æ•°æ³¨å†Œåä¼šå¹¶è¡Œè°ƒç”¨ã€‚</li>
<li>é¡ºåºçš„ï¼šåç§°å¸¦æœ‰<code>bail</code>ï¼Œè¯¥ç±»å‡½æ•°æ³¨å†Œåä¼šé¡ºåºè°ƒç”¨ã€‚</li>
<li>æµå¼çš„ï¼šåç§°å¸¦æœ‰<code>waterfall</code>ï¼Œè¯¥ç±»å‡½æ•°æ³¨å†Œåï¼Œè°ƒç”¨æ—¶ä¼šæµå¼å¤„ç†ï¼Œå°†ä¸Šä¸€ä¸ªå‡½æ•°çš„è¿”å›ç»“æœä½œä¸ºä¸‹ä¸€ä¸ªå‡½æ•°çš„å‚æ•°ã€‚</li>
<li>ç»„åˆçš„ï¼šä¹Ÿå­˜åœ¨ä¸Šè¿°ä¸‰ç§è§„åˆ™ç»“åˆåœ¨ä¸€èµ·çš„é’©å­ã€‚</li>
</ul>
<p>é€šè¿‡è¿™äº›é’©å­ï¼Œæ’ä»¶å¼€å‘è€…å¯ä»¥å¹²é¢„æ„å»ºçš„æ•´ä¸ªæµç¨‹ï¼Œä»è€Œå®ç°å¯¹æ„å»ºè¿‡ç¨‹å’Œå†…å®¹çš„æ§åˆ¶ï¼Œå¦‚ä¾èµ–æŸ¥æ‰¾ï¼Œæ–‡ä»¶ç›‘å¬ã€ä¿®æ”¹æ–‡ä»¶å†…å®¹ç­‰ï¼Œæ‰€ä»¥ç¼–å†™ä¸€ä¸ªæ’ä»¶çš„å…³é”®å°±åœ¨äºä½¿ç”¨å„ç§hooksé’©å­å‡½æ•°ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬ä»…ç®€å•äº†è§£äº†loaderå’Œpluginï¼Œå®é™…å¼€å‘ä¸­å¯èƒ½è¦å¤æ‚å¾—å¤šï¼Œè¿™é‡Œä¹Ÿä¸å¯èƒ½ç©·å°½æ‰€æœ‰åœºæ™¯å’Œç”¨æ³•ï¼Œä»…åšæŠ›ç –å¼•ç‰ï¼Œåœ¨å®é™…å¼€å‘çš„æ—¶å€™è¿˜éœ€è¦è‡ªè¡ŒæŸ¥é˜…ç›¸å…³æ–‡æ¡£ï¼Œä½œæ·±å…¥äº†è§£ã€‚</p>
<p>å‚è€ƒæ–‡æ¡£ï¼š<a href="https://webpack.docschina.org/">webpackå®˜ç½‘-ä¸­æ–‡</a>ï¼Œ<a href="http://www.xbhub.com/wiki/webpack/">æ·±å…¥æµ…å‡ºwebpack</a>ï¼Œ<a href="https://www.yuque.com/fe9/basic/sdviix">æ·±å…¥äº†è§£ Webpack</a></p>
<h1 id="ç»“è¯­">ç»“è¯­</h1>
<p>webpackæ¯ä¸ªç‰ˆæœ¬éƒ½æœ‰ä¸€ä¸ªä»£å·ï¼Œ4.0è¢«å‘½ä¸º<code>Legato</code>ï¼Œæ„ä¸ºâ€œè¿å¥â€ï¼Œå¯“æ„webpackåœ¨ä¸æ–­è¿›åŒ–ã€‚webpackçš„è¿›åŒ–ç‚¹éƒ½æ˜¯é€šè¿‡è´¡çŒ®è€…å’Œç”¨æˆ·æŠ•ç¥¨æ¥å†³å®šçš„ã€‚åœ¨3.0çš„æ—¶å€™ï¼ŒæŠ•ç¥¨æœ€å¤šçš„ç”¨æˆ·ä½“éªŒã€æ„å»ºæ€§èƒ½ç­‰éƒ½åœ¨weback4.0å¾—åˆ°äº†å·¨å¤§æ”¹å–„ã€‚</p>
<p>åœ¨å½“ä¸‹ï¼Œwebpackæ˜¯ç¨³åå‰ç«¯æ„å»ºå·¥å…·ç•Œæ‰›æŠŠå­ä¹‹ä½ï¼Œå®ƒç¡®å®æ˜¯ä¸€æ¬¾ä¼˜ç§€çš„æ„å»ºå·¥å…·ï¼Œå®ƒä¸ä»…æ‹¥æœ‰å¼ºå¤§çš„æ‰©å±•èƒ½åŠ›ï¼Œè¿˜æ‹¥æœ‰ä¸€ç¾¤ä¼˜ç§€çš„å¼€å‘è€…ï¼Œæ‹¥æœ‰æ´»è·ƒçš„ç¤¾åŒºï¼Œç»™å®ƒæä¾›æºæºä¸æ–­çš„ç”Ÿå‘½åŠ›ï¼Œè¿™äº›éƒ½æ˜¯webpackæœ€æ ¸å¿ƒçš„ç«äº‰åŠ›ã€‚</p>
<p>åœ¨æœªæ¥ï¼Œéšç€ESModuleè§„èŒƒçš„æ™®åŠï¼Œæˆ–è®¸æˆ‘ä»¬å°†ä¸å†éœ€è¦å·¥å…·æ¥è¿›è¡Œæ¨¡å—æ‰“åŒ…ï¼Œwebpackä¹Ÿæœ‰å¯èƒ½è¢«æ›¿ä»£ï¼Œä½†æ˜¯æˆ‘ç›¸ä¿¡æ„å»ºå·¥å…·ä¸ä¼šé€€å‡ºèˆå°ï¼Œè€Œåªä¼šåšè¶Šæ¥è¶Šå¤šçš„äº‹æƒ…ï¼Œå› ä¸ºå·¥ç¨‹åŒ–çš„ç†å¿µå·²æ·±å…¥äººå¿ƒã€‚</p>
<p>ä½†æ˜¯ï¼Œå­¦ä¹ webpackè¿™ç±»æ„å»ºå·¥å…·å¹¶ä¸æ˜¯æˆ‘ä»¬çš„æœ€ç»ˆç›®çš„ï¼Œå› ä¸ºå½’æ ¹ç»“åº•ä»–ä»¬åªä¸è¿‡æ˜¯ä¸€ä¸ªå·¥å…·è€Œå·²ï¼Œæ˜¯å·¥å…·å°±ä¼šè¢«æ›´æ–°è¢«å–ä»£ï¼Œè€Œå¦‚ä½•åˆ©ç”¨å·¥å…·æ¥è§£æ”¾ç”Ÿäº§åŠ›æ‰åº”è¯¥æ˜¯å‰ç«¯å·¥ç¨‹åŒ–çš„æœ€ç»ˆç›®çš„ã€‚å‰ç«¯å·¥ç¨‹åŒ–æ›´é‡è¦çš„æ˜¯ä¸€ç§æ€æƒ³ï¼Œè€Œä¸æ˜¯ç‰¹æŒ‡æŸä¸ªç‰¹å®šçš„å·¥å…·ï¼Œä»–ä»¬ä»…æ˜¯æ‰‹æ®µè€Œå·²ã€‚åœ¨å·¥ä½œä¸­è¦æœ‰æ„è¯†å°†ä¸€äº›å¤æ‚æˆ–è€—æ—¶çš„å·¥ä½œäº¤ç»™ç¨‹åºæ¥åšï¼Œå¹¶ä¸”å¯ä»¥å°†ç”¨åˆ°çš„å·¥å…·å’Œæ–¹æ³•åˆ†äº«ç»™å…¶ä»–äººï¼Œå¦‚æ­¤ä¸ä»…å¯ä»¥æé«˜è‡ªå·±å’Œå›¢é˜Ÿçš„å¼€å‘æ•ˆç‡ï¼Œè¿˜èƒ½æå‡è‡ªå·±çš„å½±å“åŠ›ï¼Œå‡èŒåŠ è–ªï¼Œè¿å¨¶ç™½å¯Œç¾... æƒ³æƒ³æ˜¯ä¸æ˜¯è§‰å¾—æœ‰ç‚¹å°å¿ƒæœºå‘¢ï¼Ÿ</p>

							</div>
	<div class="wow fadeInUp vt-post-tags">
 
				<a href="https://www.bwrong.cn/tag/webpack/" rel="tag">webpack</a>
				 
					</div>
<nav class="navigation3 post-navigation3" role="navigation">

		<div class="nav-links3">
      
		<div class="wow fadeInUp nav-previous3"><a href="https://www.bwrong.cn/post/dev-tools05/" rel="prev"> ã€å‰ç«¯å·¥ç¨‹åŒ–ã€‘ç¯‡äº” æœªæ¥å·²æ¥-Babel</a></div>
		 
		 
		<div class="wow fadeInUp nav-next3"><a href="https://www.bwrong.cn/post/dev-tools03/" rel="next"> ã€å‰ç«¯å·¥ç¨‹åŒ–ã€‘ç¯‡ä¸‰ å¸­å·å…«è’-Webpackï¼ˆåŸºç¡€ï¼‰</a></div>
		
		</div>
	</nav>
	<div class="wow fadeInUp author-info">
	<div class="author-avatar pull-left"><img src="https://www.bwrong.cn/images/avatar.png" ></div>
 
	<div class="author-description"><div class="author-title"><div class="author-link" rel="author">BWrong</div></div>


	<p class="author-bio">æ„¿ä½ èµ°å‡ºåŠç”Ÿï¼Œå½’æ¥ä»æ˜¯å°‘å¹´</p></div></div>
	
		</div>



</article>

<div id="marlin_lite_about_widget-2" class="wow fadeInUp widget marlin_lite_about_widget" data-wow-delay="0.1s">

        
		<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src='https://www.bwrong.cn/media/scripts/Valine.min.js'></script>

<div class="comment"></div>
<script>
        new Valine({
            av: AV,
            el: '.comment',
            lang: 'zh-cn',
            visitor: false, // é˜…è¯»é‡ç»Ÿè®¡
            
            admin_email:'wang11535041@qq.com',
            
            
            emoticon_url: '/media/alu',
             
      emoticon_list: ["å.png","å–·è¡€.png","ç‹‚æ±—.png","ä¸è¯´è¯.png","æ±—.png","åç­‰.png","çŒ®èŠ±.png","ä¸é«˜å…´.png","ä¸­åˆ€.png","å®³ç¾.png","çš±çœ‰.png","å°çœ¼ç›.png","ä¸­æŒ‡.png","å°´å°¬.png","ç…ä½ .png","æƒ³ä¸€æƒ³.png","ä¸­æª.png","å¾—æ„.png","è‚¿åŒ….png","æ‰‡è€³å…‰.png","äº²äº².png","æƒŠå–œ.png","è„¸çº¢.png","æ— æ‰€è°“.png","ä¾¿ä¾¿.png","æ„¤æ€’.png","èœ¡çƒ›.png","çŒ®é»„ç“œ.png","å†…ä¼¤.png","æŠ•é™.png","è§‚å¯Ÿ.png","çœ‹ä¸è§.png","å‡»æŒ.png","æŠ é¼».png","é‚ªæ¶.png","çœ‹çƒ­é—¹.png","å£æ°´.png","æŠ½çƒŸ.png","é”çœ‰.png","è£…å¤§æ¬¾.png","åèˆŒ.png","æ— å¥ˆ.png","é•¿è‰.png","èµä¸€ä¸ª.png","å‘²ç‰™.png","æ— è¯­.png","é˜´æš—.png","ä¸å‡ºæ‰€æ–™.png","å’½æ°”.png","æœŸå¾….png","é«˜å…´.png","åè¡€å€’åœ°.png","å“­æ³£.png","æ¬¢å‘¼.png","é»‘çº¿.png","å–œæè€Œæ³£.png","å–·æ°´.png","æ·±æ€.png","é¼“æŒ.png","æš—åœ°è§‚å¯Ÿ.png"],
     
      app_id: 'jaz3TfUjRowK9fOMAPb9yw6i-MdYXbMMI',
      
      
      app_key: 'pbltxx4rElIP1RStL3AwujSp',
         
          
      placeholder: 'æ¬¢è¿ä½ ç•™ä¸‹è¶³è¿¹'
       
        });
    </script>





		</div>

			</div>
			


<div class="tocc col l3 hide-on-med-and-down">

        <div class="toc-widget">

            <div class="toc-title"></div>

            <div id="toc-content">


			</div>
        </div>
    </div>


<script src="https://www.bwrong.cn/media/scripts/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '.entry-summary',
            headingsOffset: -($(window).height() * 0.4 - 45),
            // headingsOffset: -205,
            headingSelector: 'h1,h2' //**
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('.entry-summary').children('h1, h2').each(function () {/**/
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget').parent();
        // let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });
    });
</script>






			</div>
		</div>


		 <footer id="colophon" class="site-footer">

	<div class="container">

		<div class="copyright"> <br>Theme: <a
				href="https://github.com/alterfang/gridea-theme-pan" target="_blank" title="Pan"><span>Pan</span></a>.
			Powered by <a href="https://gridea.dev/" target="_blank" title="Gridea"><span>Gridea</span></a> . ç‰ˆæƒæ‰€æœ‰ï¼š<a href="https://beian.miit.gov.cn/" target="_blank"><span>èœ€ICPå¤‡2023018303å·-1</span></a></div>
	</div>

</footer>
		<!-- loding -->
		<div class="loader">
			<div class="loader-content">
				<div class="songjingge">
					<span></span>
					<span></span>
					<span></span>
					<span></span>
					<span></span>
				</div>
			</div>
		</div>
<script id="rendered-js">
	window.onload = function () {
			var loader = document.getElementsByClassName("loader")[0];
			loader.className = "loader fadeout"; //ä½¿ç”¨æ¸éšçš„æ–¹æ³•æ·¡å‡ºloading page
			setTimeout(function () {
				loader.style.display = "none";
			}, 0);
	};
</script>


</div>

<script src="https://cdn.bootcss.com/fitvids/1.2.0/jquery.fitvids.min.js"></script>
<script type='text/javascript' src='https://www.bwrong.cn/media/scripts/marlin-scripts.js'></script>
<script src="https://www.bwrong.cn/media/scripts/lately.min.js"></script>
<script>jQuery(document).ready(function () { $.lately({ 'target': '.lately-a,.lately-b,.lately-c' }) });</script>
<style type="text/css">
  a.back_to_top {
    text-decoration: none;
    position: fixed;
    bottom: 40px;
    right: 30px;
    background: #f0f0f0;
    height: 40px;
    width: 40px;
    border-radius: 50%;
    line-height: 36px;
    font-size: 18px;
    text-align: center;
    transition-duration: .5s;
    transition-propety: background-color;
    display: none;
  }

  a.back_to_top span {
    color: #888;
  }

  a.back_to_top:hover {
    cursor: pointer;
    background: #dfdfdf;
  }

  a.back_to_top:hover span {
    color: #555;
  }

  @media print,
  screen and (max-width: 580px) {
    .back_to_top {
      display: none !important;
    }
  }
</style><a id="back_to_top" href="#" class="back_to_top"><span><i class="iconfont icon-xiangshang"></i></span>
</a>

<script>
$(document).ready((function (_this) {
    return function () {
      var bt;
      bt = $('#back_to_top');
      if ($(document).width() > 480) {
        $(window).scroll(function () {
          var st;
          st = $(window).scrollTop();
          if (st > 30) {
            return bt.css('display', 'block');
          } else {
            return bt.css('display', 'none');
          }
        });
        return bt.click(function () {
          $('body,html').animate({
            scrollTop: 0
          }, 800);
          return false;
        });
      }
    };
  })(this));
//   $(window).load(function () {
//     //å¼‚æ­¥å»¶è¿ŸåŠ è½½æ ·å¼
//     var link = $('<link />');
//     link.attr('href', 'https://fonts.googleapis.com/css?family=Dancing+Script|Noto+Sans+SC:300|Montserrat&display=swap');
//     link.attr('rel', 'stylesheet');
//     link.appendTo($('head'));
// });
</script>

<!-- å® ç‰© -->
<canvas id="live2dcanvas" width="200" height="400" class="live2d"></canvas>
<style>
  #live2dcanvas {
    position: fixed;
    right: 0px;
    z-index: 999;
    pointer-events: none;
    bottom: -40px;
    width: 200px;
    height: 400px;
  }

  @media (max-width: 768px) {
    #live2dcanvas {
      width: 150px;
      height: 300px;
    }
  }

  @media (max-width: 639px) {
    #live2dcanvas {
      display: none !important;
    }
  }
</style>
<script src="https://www.bwrong.cn/media/scripts/L2Dwidget.min.js"></script>
<script>
  //åˆå§‹åŒ–å°äººç‰© éœ€è®¾ç½®å±æ€§pluginRootPath: "live2dw/"æŒ‡æ˜èµ„æºè·Ÿè·¯å¾„
  L2Dwidget.init({
    pluginRootPath: "media/",//èµ„æºrootè·¯å¾„
    pluginJsPath: "scripts/",//jsç›¸å¯¹rootçš„è·¯å¾„
    pluginModelPath: "model/",//æ¨¡å‹ç›¸å¯¹rootçš„è·¯å¾„
    tagMode: !1,
    debug: !1,
    model: {
      scale: 2,
      jsonPath: "/media/model/live2d-widget-model-epsilon/Epsilon2.1.model.json"
    },
    display: {//å¤§å°ä½ç½®ä»€ä¹ˆçš„è‡ªå·±æ…¢æ…¢è°ƒå°±æ˜¯äº†
      position: "right",//å®šä½
      width: 130,//å®½åº¦
      height: 210,//é«˜åº¦
      hOffset: -40,//å·¦å³
      vOffset: 0//ä¸Šä¸‹
    },
    mobile: {
      show: !1
    },
    log: !1
  });
</script>
<!-- å® ç‰©ç»“æŸ -->

		<script data-no-instant>
    // (function ($) {
    //     $.extend({
    //         adamsOverload: function () {
    //             $('.navigation:eq(0)').remove();
    //             $("").attr("rel" , "external");
    //             $("a[rel='external'],a[rel='external nofollow']").attr("target","_blank");
    //             $("a.vi").attr("rel" , "");
    //             $.viewImage({
    //                 'target'  : 'img',
    //                 'exclude' : '.vsmile-icons img,.gallery img',
    //                 'delay'   : 300
    //             });
    //             $.lately({
    //                 'target' : '.commentmetadata a,.infos time,.post-list time'
	// 			});
	// 			console.log(prettyPrint)
	// 			if(prettyPrint) prettyPrint();

    //             $('ul.links li a').each(function(){
    //                 if($(this).parent().find('.bg').length==0){
    //                     $(this).parent().append('<!---<div class="bg" style="background-image:url(https://c3.glgoo.top/s2/favicons?domain='+$(this).attr("href")+')"></div>--->')
    //                 }
    //             });
    //         }
    //     });
    // })(jQuery);
	// jQuery.adamsOverload();

    (function ($) {
        $.extend({
            adamsOverload: function () {
                $.viewImage({
                    'target'  : '.song img',
                    'exclude' : '.vsmile-icons img',
                    'delay'   : 300
                });
            }
        });
    })(jQuery);
    jQuery.adamsOverload();
</script>

</body>
</html>
